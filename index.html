<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OLM : Votre Jumeau Num√©rique de Comp√©tences</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --c-background: #f9f9fb;
      --c-text-primary: #1d1d1f;
      --c-text-secondary: #515154;
      --c-surface: #ffffff;
      --c-border: #ebebed;
      --c-primary: #007aff;
      --c-primary-hover: #0071e3;
      --c-primary-light: #e5f2ff;
      --c-success: #34c759;
      --c-success-light: #eaf8ee;
    }
    html { scroll-behavior: smooth; }
    body {
      background-color: var(--c-background);
      color: var(--c-text-primary);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    :focus-visible { outline: 2px solid var(--c-primary); outline-offset: 2px; border-radius: 8px; }
    .card {
      background-color: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.25rem;
      box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px 0 rgb(0 0 0 / 0.07); }
    .fade-in { animation: fadeIn 0.7s cubic-bezier(0.33, 1, 0.68, 1) forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .lang-btn.active { font-weight: 600; color: var(--c-primary); background-color: var(--c-primary-light); }
    .progress-bar-bg { background-color: #eff0f2; }
    .progress-bar-fg { background-color: var(--c-primary); transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .progress-bar-gain { background-color: var(--c-success); transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .modal-backdrop { background-color: rgba(0,0,0,0.4); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); }
  </style>
</head>
<body class="text-base">

  <div class="fixed top-4 right-4 z-50">
    <div class="flex items-center gap-1 text-sm font-medium text-slate-600 bg-white/80 backdrop-blur-md p-1 rounded-full border border-slate-200 shadow-sm">
        <button id="lang-fr" class="lang-btn px-3 py-1 rounded-full">FR</button>
        <button id="lang-en" class="lang-btn px-3 py-1 rounded-full">EN</button>
    </div>
  </div>

  <header class="max-w-7xl mx-auto px-6 py-20 md:py-28 text-center">
    <h1 class="text-4xl md:text-6xl font-bold tracking-tight text-slate-900" data-translate-key="title"></h1>
    <p class="mt-4 text-lg md:text-xl max-w-3xl mx-auto text-slate-600" data-translate-key="subtitle"></p>
  </header>

  <main class="max-w-7xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <section class="lg:col-span-3" aria-labelledby="llm-connect-title">
      <div class="text-center">
        <h2 id="llm-connect-title" class="text-2xl font-bold text-slate-800" data-translate-key="connect_agent_title"></h2>
        <p class="mt-2 text-slate-600 max-w-2xl mx-auto" data-translate-key="connect_agent_subtitle"></p>
      </div>
      <nav aria-label="Fournisseurs LLM" class="mt-8">
        <div id="llmButtons" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5"></div>
      </nav>
    </section>

    <section class="lg:col-span-2 card" aria-labelledby="profil-title">
      <div class="p-6 border-b border-slate-200/80 flex justify-between items-start">
        <div>
            <h3 id="profil-title" class="text-lg font-semibold flex items-center gap-3 text-slate-800">
                <svg class="w-6 h-6 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Z"/><path d="M12 17.5a7.5 7.5 0 0 1 7.5-7.5"/><path d="M12 17.5a7.5 7.5 0 0 0-7.5-7.5"/></svg>
                <span id="profileTitle" data-translate-key="profile_title_empty"></span>
            </h3>
            <span id="providerBadge" class="mt-2 hidden items-center gap-2 text-xs pl-2 pr-3 py-1 rounded-full bg-slate-100 text-slate-700 font-medium"></span>
        </div>
        <div id="objectiveWidget" class="hidden text-right">
            <p class="text-xs text-slate-500" data-translate-key="objective_widget_title"></p>
            <p id="objectiveText" class="text-sm font-semibold text-blue-600"></p>
        </div>
      </div>
      <div class="p-6">
        <div id="radar" class="w-full h-72 flex items-center justify-center text-sm text-slate-500" data-translate-key="radar_placeholder"></div>
      </div>
    </section>

    <section class="card" aria-labelledby="console-title">
      <div class="p-6 border-b border-slate-200/80"><h3 id="console-title" class="text-lg font-semibold flex items-center gap-3 text-slate-800">
        <svg class="w-6 h-6 text-slate-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
        <span data-translate-key="console_title"></span></h3></div>
      <div class="p-6">
        <div id="console" class="bg-slate-900 text-slate-300 text-xs rounded-xl p-4 h-96 overflow-auto font-mono selection:bg-blue-500/30" aria-live="polite"></div>
        <div class="mt-4 flex gap-2">
          <button id="resetBtn" class="w-full px-4 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-sm font-semibold transition-colors" data-translate-key="reset_btn"></button>
        </div>
      </div>
    </section>
    
    <section id="aiInsightSection" class="lg:col-span-3 hidden" aria-labelledby="ai-insight-title">
         <div class="border border-blue-200 bg-blue-50/50 rounded-2xl p-6">
            <h3 id="ai-insight-title" class="text-lg font-semibold text-blue-800 flex items-center gap-3">
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                <span data-translate-key="ai_insight_title"></span>
            </h3>
            <p id="aiInsightText" class="mt-3 text-sm text-blue-900/80"></p>
         </div>
    </section>

    <section class="lg:col-span-3 py-4" aria-labelledby="reco-title">
      <h2 id="reco-title" class="text-2xl font-bold text-slate-800"><span data-translate-key="challenges_title"></span> <span id="recoProvider" class="text-slate-500 font-normal text-xl"></span></h2>
      <p id="recoHint" class="mt-2 text-slate-600" data-translate-key="challenges_placeholder"></p>
      <div id="recoNotice" class="hidden fixed top-6 left-6 z-50 max-w-sm rounded-xl border border-green-200 bg-green-100/80 backdrop-blur-md text-green-900 text-sm px-5 py-3 shadow-lg" aria-live="polite"></div>

      <div id="recoSkeletons" class="mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        <div class="h-48 rounded-2xl bg-slate-200 animate-pulse"></div>
        <div class="h-48 rounded-2xl bg-slate-200 animate-pulse"></div>
        <div class="h-48 rounded-2xl bg-slate-200 animate-pulse lg:block hidden"></div>
      </div>

      <div id="recoGrid" class="mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <section class="lg:col-span-3 py-4" aria-labelledby="gains-title">
      <h2 id="gains-title" class="text-2xl font-bold text-slate-800" data-translate-key="progress_title"></h2>
      <p id="gainsHint" class="mt-2 text-slate-600" data-translate-key="progress_placeholder"></p>
      <div id="skillProgress" class="mt-6 grid md:grid-cols-2 gap-x-8 gap-y-5"></div>
    </section>

    <section id="certSection" class="lg:col-span-3 py-4" aria-labelledby="cert-title">
        <h2 id="cert-title" class="text-2xl font-bold text-slate-800" data-translate-key="certifications_title"></h2>
        <p id="certHint" class="mt-2 text-slate-600" data-translate-key="certifications_placeholder"></p>
        <div id="certGrid" class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>
  </main>

  <section class="max-w-7xl mx-auto px-6 py-20">
    <div class="grid md:grid-cols-3 gap-6">
        <article class="card p-6 flex flex-col">
            <div class="flex-1">
                <h3 class="text-lg font-semibold flex items-center gap-3" data-translate-key="what_is_olm_title"></h3>
                <p class="mt-2 text-sm text-slate-600" data-translate-key="what_is_olm_p"></p>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-200/60">
                <button type="button" id="showJsonBtn" class="text-sm font-semibold text-[var(--c-primary)] hover:text-[var(--c-primary-hover)] transition-colors" data-translate-key="what_is_olm_button"></button>
            </div>
        </article>
        <article class="card p-6">
            <h3 class="text-lg font-semibold flex items-center gap-3" data-translate-key="why_mcp_title"></h3>
            <p class="mt-2 text-sm text-slate-600" data-translate-key="why_mcp_p"></p>
        </article>
        <article class="card p-6">
            <h3 class="text-lg font-semibold flex items-center gap-3" data-translate-key="design_fiction_title"></h3>
            <p class="mt-2 text-sm text-slate-600" data-translate-key="design_fiction_p"></p>
        </article>
    </div>
  </section>

  <div id="modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="fixed inset-0 modal-backdrop" data-close></div>
    <div class="relative bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl max-w-2xl w-full border border-white/50">
      <div class="p-8">
        <h2 id="modalTitle" class="text-xl font-semibold text-slate-800 flex items-center gap-3"></h2>
        <p class="mt-1 text-slate-600" data-translate-key="modal_subtitle"></p>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <fieldset class="border border-slate-200/80 rounded-xl p-4 bg-white/50">
            <legend class="px-2 text-sm font-semibold text-slate-700" data-translate-key="modal_data_title"></legend>
            <div id="consents" class="mt-2 space-y-3"></div>
          </fieldset>

          <fieldset class="border border-slate-200/80 rounded-xl p-4 flex flex-col bg-white/50">
            <legend class="px-2 text-sm font-semibold text-slate-700" data-translate-key="modal_objective_title"></legend>
            <div class="flex-1">
              <label for="contextSelect" class="sr-only" data-translate-key="modal_objective_select_sr"></label>
              <select id="contextSelect" class="mt-2 w-full border border-slate-300 rounded-lg px-3 py-2 text-base focus:border-blue-500 focus:ring-blue-500"></select>
              <p class="mt-2 text-xs text-slate-500" data-translate-key="modal_objective_p"></p>
            </div>
            <button id="addContextBtn" type="button" class="mt-3 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors self-start" data-translate-key="modal_add_context_btn"></button>
          </fieldset>
        </div>

        <div class="mt-8 flex items-center justify-end gap-3">
          <button type="button" class="px-5 py-2.5 rounded-xl bg-white/80 border border-slate-300 hover:bg-white text-slate-800 font-semibold" data-close data-translate-key="modal_cancel_btn"></button>
          <button id="authorizeBtn" class="px-5 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold" data-translate-key="modal_authorize_btn"></button>
        </div>
      </div>
    </div>
  </div>

  <div id="certModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="certModalTitle">
        <div class="fixed inset-0 modal-backdrop" data-cert-close></div>
        <div class="relative bg-white/90 backdrop-blur-xl rounded-2xl shadow-2xl max-w-lg w-full border border-white/50">
            <div class="p-8">
                <h2 id="certModalTitle" class="text-lg font-semibold text-slate-800"></h2>
                <p id="certModalSubtitle" class="mt-1 text-slate-500"></p>

                <div class="mt-4 inline-flex items-center gap-2 rounded-full bg-blue-100 text-blue-800 px-3 py-1 text-xs font-semibold">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    <span data-translate-key="cert_modal_recognized"></span>
                </div>

                <p id="certModalRationale" class="mt-4 text-slate-600"></p>

                <div id="certSyllabusContainer" class="mt-4 hidden border-t border-slate-200 pt-4">
                    <h4 class="font-semibold text-slate-700" data-translate-key="cert_modal_syllabus_title"></h4>
                    <ul id="certSyllabusList" class="mt-2 text-slate-600 list-disc list-inside space-y-1"></ul>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row-reverse gap-3">
                    <button id="addCertToAgentBtn" class="w-full px-4 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold"></button>
                    <button id="viewSyllabusBtn" class="w-full px-4 py-2.5 rounded-xl bg-white/80 border border-slate-300 hover:bg-white text-slate-800 font-semibold"></button>
                </div>
            </div>
        </div>
    </div>

    <div id="jsonModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="jsonModalTitle">
        <div class="fixed inset-0 modal-backdrop" data-json-close></div>
        <div class="relative bg-slate-900/90 backdrop-blur-xl rounded-2xl shadow-2xl max-w-4xl w-full border border-white/20">
            <div class="p-6">
                <div class="flex justify-between items-center">
                    <h2 id="jsonModalTitle" class="text-lg font-semibold text-slate-200" data-translate-key="json_modal_title"></h2>
                    <button type="button" class="text-slate-400 hover:text-white" data-json-close aria-label="Close">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="mt-4 bg-slate-800/50 rounded-xl p-4 h-[60vh] overflow-auto font-mono text-xs text-sky-300 border border-slate-700">
                    <pre><code id="jsonContent"></code></pre>
                </div>
            </div>
        </div>
    </div>


  <footer class="border-t border-slate-200/80 mt-20">
    <div class="max-w-7xl mx-auto px-6 py-8 text-sm text-slate-500 text-center flex flex-col items-center gap-4">
        <p data-translate-key="footer_text"></p>
        <a href="https://www.linkedin.com/in/arnaud-guiovanna-5aa8b5159/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-slate-500 hover:text-[var(--c-primary)] font-semibold transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
            <span data-translate-key="creator_linkedin_btn"></span>
        </a>
    </div>
  </footer>

  <script>
    const translations = {
        fr: {
            title: "Open Learner Model AI",
            subtitle: "L'Open Learner Model est votre jumeau num√©rique d'apprentissage. Connectez-le √† une IA pour g√©n√©rer un parcours de carri√®re personnalis√©, bas√© sur votre profil unique. <br><br> <div class='mt-6 max-w-2xl mx-auto text-left text-sm border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg text-blue-900'><p class='font-semibold'>// Note : ceci est un design fiction</p><p class='mt-2'>Dans cette d√©mo, vous incarnez John Doe, un plombier fictif qui dispose d'un Open Learner Model. Aucune donn√©e r√©elle n'est utilis√©e. Il s'agit d'une fiction sp√©culative explorant les futurs possibles de l'apprentissage.</p><blockquote class='mt-4 border-l-2 border-blue-300 pl-3 italic text-xs'>'ChatGPT est aujourd'hui la plus grande plateforme d'apprentissage au monde. L'apprentissage est l'un des principaux usages de la plateforme avec 600 millions d'utilisateurs.'</blockquote><footer class='mt-1 not-italic'>‚Äî Leah Belsky, VP Education chez OpenAI</footer><p class='mt-3 text-xs'>C'est cette d√©claration qui a inspir√© ce prototype : si les IA deviennent les nouvelles plateformes d'apprentissage mondiales, comment garantir une exp√©rience centr√©e sur l'apprenant ? L'<strong>Open Learner Model (OLM)</strong> est une piste possible. L'OLM est un jumeau num√©rique portable et interop√©rable, qui compile vos comp√©tences et exp√©riences, et vous permet de vous connecter √† n'importe quel agent IA pour un parcours sur-mesure, tout en gardant le contr√¥le de vos donn√©es.</p></div>",
            connect_agent_title: "Choisissez votre Agent IA",
            connect_agent_subtitle: "S√©lectionnez un agent pour analyser votre profil et construire votre plan de progression.",
            profile_title_empty: "Profil OLM",
            profile_title_user: "Profil OLM de John Doe",
            connected_to: "Connect√© √†",
            objective_widget_title: "Objectif Actuel",
            radar_placeholder: "Connectez un agent pour visualiser le profil.",
            console_title: "Console d'Activit√©",
            console_placeholder: "En attente de connexion...",
            reset_btn: "R√©initialiser",
            analyze_with: "Analyser avec {provider}",
            ai_insight_title: "Synth√®se de l'Agent",
            challenges_title: "Vos Prochains D√©fis",
            challenges_by: "‚Äî par {provider}",
            challenges_placeholder: "Connectez un agent pour d√©couvrir vos d√©fis personnalis√©s.",
            reco_notice_success: "‚úÖ Parcours g√©n√©r√© avec succ√®s. La progression ci-dessous simule votre gain potentiel.",
            progress_title: "Suivi de Progression",
            progress_placeholder: "L'√©volution de vos comp√©tences appara√Ætra ici.",
            certifications_title: "Certifications g√©n√©r√©es par l‚Äôagent IA",
            certifications_placeholder: "Connectez un agent pour obtenir des certifications align√©es sur votre profil.",
            what_is_olm_title: "üß† Qu‚Äôest-ce qu‚Äôun OLM ?",
            what_is_olm_p: "L'<strong>Open Learner Model</strong> est votre profil de comp√©tences dynamique et portable. Il vous appartient, vous le contr√¥lez, et il fonctionne partout.",
            why_mcp_title: "üîó Le standard MCP",
            why_mcp_p: "Le <strong>Model Context Protocol (MCP)</strong> est un protocole universel qui permet √† votre OLM de communiquer de fa√ßon s√©curis√©e et standardis√©e avec n'importe quelle IA.",
            design_fiction_title: "üí° Une Vision du Futur",
            design_fiction_p: "Cette d√©mo illustre un futur o√π chaque apprenant poss√®de et contr√¥le ses donn√©es d'apprentissage, ouvrant la voie √† une reconnaissance universelle des comp√©tences.",
            what_is_olm_button: "Voir un exemple",
            json_modal_title: "Exemple de donn√©es brutes OLM",
            modal_title: "Autoriser la connexion",
            modal_subtitle: "Partagez les donn√©es de votre OLM et d√©finissez un objectif pour l'analyse.",
            modal_data_title: "Donn√©es √† partager",
            modal_objective_title: "Objectif",
            modal_objective_select_sr: "S√©lectionnez un objectif",
            modal_objective_p: "L'agent adaptera ses recommandations √† cet objectif.",
            modal_add_context_btn: "+ Ajouter un objectif",
            modal_cancel_btn: "Annuler",
            modal_authorize_btn: "Autoriser & Lancer",
            footer_text: "Un design fiction propos√© par Arnaud Guiovanna ‚Ä¢ 2025",
            log_connecting: "Connexion s√©curis√©e √† l'agent IA...",
            log_connection_request: "OLM ‚ûú Demande de connexion √† {provider}",
            log_handshake_ok: "Handshake MCP 1.0 : OK",
            log_consent: "Consentement ‚ûú Donn√©es partag√©es : {granted}",
            log_objective: "üéØ Objectif transmis : Am√©liorer les comp√©tences pour \"{context}\".",
            log_analysis: "Analyse OLM ‚ûú {count} optimisations potentielles identifi√©es.",
            log_skill_gain: "‚úî Gain de comp√©tence : {skill} (+{delta}) | source: {why}",
            log_recos_generated: "‚úî Recommandations g√©n√©r√©es, pr√™tes √† √™tre explor√©es.",
            log_challenge_complete: "‚úî D√©fi relev√© : \"{title}\" (+{delta} {skill})",
            log_new_skill: "‚ú® Nouvelle comp√©tence ajout√©e au profil : \"{skill}\"",
            reco_card_skill: "Comp√©tence",
            reco_card_duration: "Dur√©e",
            reco_card_completed: "Termin√©",
            reco_card_potential_gain: "+{delta} pts",
            reco_card_take_challenge: "Relever le d√©fi",
            progress_bar_gain_text: "{initial} ‚ûú {final} (+{gain})",
            add_context_prompt: "Entrez le nom de votre nouvel objectif :",
            reco_notice_update: "‚úÖ Comp√©tence \"{skill}\" mise √† jour dans votre profil.",
            cert_modal_title: "Certification : {title}",
            cert_modal_subtitle: "Propos√©e par votre agent {agent}",
            cert_modal_recognized: "Reconnu par le Minist√®re du Travail",
            cert_modal_add_btn: "Ajouter √† mon agent",
            cert_modal_syllabus_btn: "Voir le programme",
            cert_modal_syllabus_btn_hide: "Masquer le programme",
            cert_modal_syllabus_title: "Programme de la certification",
            cert_added_notice: "‚úÖ Le parcours de certification a √©t√© ajout√© √† votre agent {agent}.",
            creator_linkedin_btn: "Visitez le profil Linkedin"
        },
        en: {
            title: "Open Learner Model AI",
            subtitle: "The Open Learner Model is your digital learning twin. Connect it to an AI to generate a personalized career path, based on your unique profile. <br><br> <div class='mt-6 max-w-2xl mx-auto text-left text-sm border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg text-blue-900'><p class='font-semibold'>// Note: this is a design fiction</p><p class='mt-2'>In this demo, you play as John Doe, a fictional plumber who has an Open Learner Model. No real data is used. This is a speculative fiction exploring possible futures of learning.</p><blockquote class='mt-4 border-l-2 border-blue-300 pl-3 italic text-xs'>'ChatGPT is now the world's largest learning platform. Learning is one of the top use cases on the platform at 600 million users.'</blockquote><footer class='mt-1 not-italic'>‚Äî Leah Belsky, VP Education at OpenAI</footer><p class='mt-3 text-xs'>This statement inspired this prototype: if AIs become the new global learning platforms, how do we ensure an experience centered on the learner? The <strong>Open Learner Model (OLM)</strong> is one possible answer. The OLM is a portable and interoperable digital twin that compiles your skills and experiences, allowing you to connect to any AI agent for a personalized path, while keeping full control over your data.</p></div>",
            connect_agent_title: "Choose your AI Agent",
            connect_agent_subtitle: "Select an agent to analyze your profile and build your progression plan.",
            profile_title_empty: "OLM Profile",
            profile_title_user: "John Doe's OLM Profile",
            connected_to: "Connected to",
            objective_widget_title: "Current Objective",
            radar_placeholder: "Connect an agent to visualize the profile.",
            console_title: "Activity Console",
            console_placeholder: "Awaiting connection...",
            reset_btn: "Reset",
            analyze_with: "Analyze with {provider}",
            ai_insight_title: "Agent's Summary",
            challenges_title: "Your Next Challenges",
            challenges_by: "‚Äî by {provider}",
            challenges_placeholder: "Connect an agent to discover your personalized challenges.",
            reco_notice_success: "‚úÖ Path successfully generated. The progression below simulates your potential gain.",
            progress_title: "Progress Tracking",
            progress_placeholder: "Your skill development will appear here.",
            certifications_title: "Certifications generated with an AI agent", 
            certifications_placeholder: "Connect an agent to obtain certifications aligned with your profile.",
            what_is_olm_title: "üß† What is an OLM?",
            what_is_olm_p: "The <strong>Open Learner Model</strong> is your dynamic and portable skills profile. You own it, you control it, and it works everywhere.",
            why_mcp_title: "üîó The MCP Standard",
            why_mcp_p: "The <strong>Model Context Protocol (MCP)</strong> is the universal protocol that allows your OLM to communicate securely and standardly with any AI.",
            design_fiction_title: "üí° A Vision of the Future",
            design_fiction_p: "This demo illustrates a future where every learner owns and controls their learning data, paving the way for universal skill recognition.",
            what_is_olm_button: "See an example",
            json_modal_title: "Raw OLM Data Example",
            modal_title: "Authorize Connection",
            modal_subtitle: "Share your OLM data and set an objective for the analysis.",
            modal_data_title: "Data to Share",
            modal_objective_title: "Objective",
            modal_objective_select_sr: "Select an objective",
            modal_objective_p: "The agent will tailor its recommendations to this objective.",
            modal_add_context_btn: "+ Add objective",
            modal_cancel_btn: "Cancel",
            modal_authorize_btn: "Authorize & Launch",
            footer_text: "A design fiction by Arnaud Guiovanna ‚Ä¢ 2025",
            log_connecting: "Securely connecting to AI agent...",
            log_connection_request: "OLM ‚ûú Connection request to {provider}",
            log_handshake_ok: "MCP 1.0 Handshake: OK",
            log_consent: "Consent ‚ûú Shared data: {granted}",
            log_objective: "üéØ Objective sent: Upskill for \"{context}\".",
            log_analysis: "OLM Analysis ‚ûú {count} potential optimizations identified.",
            log_skill_gain: "‚úî Skill gain: {skill} (+{delta}) | source: {why}",
            log_recos_generated: "‚úî Recommendations generated, ready to be explored.",
            log_challenge_complete: "‚úî Challenge completed: \"{title}\" (+{delta} {skill})",
            log_new_skill: "‚ú® New skill added to profile: \"{skill}\"",
            reco_card_skill: "Skill",
            reco_card_duration: "Duration",
            reco_card_completed: "Completed",
            reco_card_potential_gain: "+{delta} pts",
            reco_card_take_challenge: "Take challenge",
            progress_bar_gain_text: "{initial} ‚ûú {final} (+{gain})",
            add_context_prompt: "Enter the name for your new objective:",
            reco_notice_update: "‚úÖ Skill \"{skill}\" updated in your profile.",
            cert_modal_title: "Certification: {title}",
            cert_modal_subtitle: "Proposed by your agent {agent}",
            cert_modal_recognized: "Recognized by the Ministry of Labour",
            cert_modal_add_btn: "Add to my agent",
            cert_modal_syllabus_btn: "View syllabus",
            cert_modal_syllabus_btn_hide: "Hide syllabus",
            cert_modal_syllabus_title: "Certification Syllabus",
            cert_added_notice: "‚úÖ The certification path has been added to your {agent} agent.",
            creator_linkedin_btn: "Arnaud Guiovanna's profile"
        }
    };

    const initialSkills = [
      { competency: { fr: "Lecture de plans", en: "Blueprint Reading" }, level: 70 },
      { competency: { fr: "Installation sanitaire", en: "Sanitary Installation" }, level: 85 },
      { competency: { fr: "Soudure cuivre", en: "Copper Welding" }, level: 65 },
      { competency: { fr: "Maintenance chaudi√®res", en: "Boiler Maintenance" }, level: 78 },
      { competency: { fr: "R√©seaux de chauffage", en: "Heating Networks" }, level: 60 },
      { competency: { fr: "Relation client", en: "Customer Relations" }, level: 55 }
    ];

    const PROVIDERS = {
      ChatGPT: { deltas: [{ skill: "Relation client", delta: 10, why: "retour chantier: communication et empathie" }, { skill: "R√©seaux de chauffage", delta: 5, why: "optimisation de circuits et √©quilibrage" }], recos: [{ title: {fr: "Efficacit√© √©nerg√©tique", en: "Energy Efficiency"}, skill: "R√©seaux de chauffage", delta: 4, duration: "2h", rationale: {fr: "param√©trage circuits radiateurs", en: "radiator circuit configuration"} }, { title: {fr: "Diagnostic chaudi√®re", en: "Boiler Diagnostics"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h30", rationale: {fr: "lecture t√©l√©m√©trie", en: "telemetry reading"} }, { title: {fr: "Situations client difficiles", en: "Difficult Customer Situations"}, skill: "Relation client", delta: 6, duration: "45min", rationale: {fr: "gestion d'objections", en: "objection handling"} }], insight: {fr: "Bonjour John. Votre profil montre une excellente ma√Ætrise de l'installation. Pour atteindre votre objectif, je sugg√®re de renforcer la 'Relation client' et d'explorer les nouvelles normes en efficacit√© √©nerg√©tique.", en: "Hello John. Your profile shows excellent installation mastery. To reach your goal, I suggest strengthening 'Customer Relations' and exploring new energy efficiency standards."} },
      Gemini: { deltas: [{ skill: "Soudure cuivre", delta: 7, why: "brasage avanc√©: contr√¥le capillarit√©" }, { skill: "Maintenance chaudi√®res", delta: 5, why: "pr√©ventif selon historique pannes" }], recos: [{ title: {fr: "Brasage cuivre avanc√©", en: "Advanced Copper Brazing"}, skill: "Soudure cuivre", delta: 7, duration: "1h", rationale: {fr: "qualit√© & s√©curit√©", en: "quality & safety"} }, { title: {fr: "Maintenance pr√©ventive", en: "Preventive Maintenance"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h", rationale: {fr: "checklist capteurs", en: "sensor checklist"} }, { title: {fr: "Checklist fin de chantier", en: "End-of-job Checklist"}, skill: "Relation client", delta: 3, duration: "20min", rationale: {fr: "satisfaction client", en: "customer satisfaction"} }], insight: {fr: "Analyse termin√©e. Vos comp√©tences techniques en 'Soudure' et 'Maintenance' sont solides. L'objectif 'Chantier en industrie' requiert une excellence dans ces domaines. Je vous propose des d√©fis pour formaliser ces savoir-faire.", en: "Analysis complete. Your technical skills in 'Welding' and 'Maintenance' are solid. The 'Industrial Site Work' objective requires excellence in these areas. I am proposing challenges to formalize this expertise."} },
      Claude: { deltas: [{ skill: "Lecture de plans", delta: 6, why: "sch√©mas isom√©triques et rep√©rage" }, { skill: "Relation client", delta: 4, why: "script de communication claire" }], recos: [{ title: {fr: "Communication proactive", en: "Proactive Communication"}, skill: "Relation client", delta: 7, duration: "30min", rationale: {fr: "anticiper les questions", en: "anticipating questions"} }, { title: {fr: "Sch√©mas isom√©triques", en: "Isometric Schematics"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "rep√®res & cotes", en: "markers & dimensions"} }, { title: {fr: "S√©curit√© gaz", en: "Gas Safety"}, skill: "Installation sanitaire", delta: 2, duration: "25min", rationale: {fr: "bonnes pratiques", en: "best practices"} }], insight: {fr: "John, votre profil est √©quilibr√©. Pour un entretien, la clart√© de la communication est aussi importante que la technique. Mes recommandations visent √† renforcer votre capacit√© √† expliquer des concepts techniques et √† mieux interagir.", en: "John, your profile is well-balanced. For an interview, clear communication is as important as technical skill. My recommendations aim to enhance your ability to explain technical concepts and to better interact with recruiters."} },
      Mistral: { deltas: [{ skill: "R√©seaux de chauffage", delta: 6, why: "optimisation europ√©enne (normes)" }, { skill: "Installation sanitaire", delta: 4, why: "conformit√© DTU" }], recos: [{ title: {fr: "Normes europ√©ennes", en: "European Standards"}, skill: "Installation sanitaire", delta: 4, duration: "1h", rationale: {fr: "s√©curit√© & conformit√©", en: "safety & compliance"} }, { title: {fr: "√âquilibrage r√©seau terrain", en: "On-site Network Balancing"}, skill: "R√©seaux de chauffage", delta: 6, duration: "1h15", rationale: {fr: "mesures & ajustements", en: "measurements & adjustments"} }, { title: {fr: "Communication chantier", en: "Site Communication"}, skill: "Relation client", delta: 4, duration: "30min", rationale: {fr: "clart√© & trace", en: "clarity & traceability"} }], insight: {fr: "Votre expertise terrain est √©vidente. Pour vous d√©marquer, une ma√Ætrise des normes europ√©ennes (DTU) est un atout consid√©rable. Les d√©fis que je propose vous permettront de valider ces connaissances sp√©cifiques.", en: "Your field expertise is clear. To stand out, mastering European standards (DTU) is a significant advantage. The challenges I'm offering will allow you to validate this specific knowledge."} },
      Llama: { deltas: [{ skill: "Relation client", delta: 5, why: "script conversationnel clair" }, { skill: "Lecture de plans", delta: 5, why: "rep√©rage symboles" }], recos: [{ title: {fr: "Lecture de plans pratique", en: "Practical Blueprint Reading"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "exercices guid√©s", en: "guided exercises"} }, { title: {fr: "Bases des r√©seaux intelligents", en: "Smart Grid Basics"}, skill: "Domotique CVC", delta: 8, duration: "40min", rationale: {fr: "rep√®res domotique", en: "home automation basics"} }, { title: {fr: "Maintenance avec l'IA", en: "AI-Assisted Maintenance"}, skill: "Maintenance chaudi√®res", delta: 4, duration: "45min", rationale: {fr: "aide au diagnostic", en: "diagnostic assistance"} }], insight: {fr: "Votre profil est solide. Je remarque un potentiel de d√©veloppement vers les technologies √©mergentes. J'ai donc inclus un d√©fi sur la 'Domotique CVC', une nouvelle comp√©tence qui pourrait fortement valoriser votre profil.", en: "Your profile is solid. I see potential for growth into emerging technologies. I have therefore included a challenge on 'HVAC Domotics', a new skill that could greatly enhance your profile."} }
    }
    
    let CONTEXTS = [
      { id: "recrutement", label: { fr: "Pr√©parer un entretien", en: "Prepare for an interview" } },
      { id: "industrie", label: { fr: "Intervenir en industrie", en: "Work on an industrial site" } },
      { id: "gestion_projet", label: { fr: "G√©rer un projet CVC", en: "Manage an HVAC project" } }
    ];

    const CERTIFICATIONS = [
      { id: "cert-openai-1", org: "ChatGPT", emoji: "ü§ñ", title: {fr:"Diagnostic √©nerg√©tique assist√© par IA", en:"AI-Assisted Energy Diagnostics"}, color:"emerald", rationale: {fr:"Recommand√© pour votre ma√Ætrise de la maintenance et votre int√©r√™t pour les nouvelles technologies.", en:"Recommended for your maintenance skills and interest in new technologies."}, syllabus: { fr: ["Module 1: Audit thermique", "Module 2: Analyse des donn√©es de consommation", "Module 3: Recommandations et ROI"], en: ["Module 1: Thermal Audit", "Module 2: Consumption Data Analysis", "Module 3: Recommendations & ROI"] } },
      { id: "cert-google-1", org: "Gemini", emoji: "‚ú®", title: {fr:"R√©seaux thermiques intelligents", en:"Smart Thermal Networks"}, color:"blue", rationale: {fr:"Votre expertise en r√©seaux de chauffage est le pr√©requis id√©al pour cette certification avanc√©e.", en:"Your heating network expertise is the ideal prerequisite for this advanced certification."}, syllabus: { fr: ["Module 1: Capteurs et IoT", "Module 2: Algorithmes d'optimisation", "Module 3: Maintenance pr√©dictive"], en: ["Module 1: Sensors & IoT", "Module 2: Optimization Algorithms", "Module 3: Predictive Maintenance"] } },
      { id: "cert-anthropic-1", org: "Claude", emoji: "üß≠", title: {fr:"Maintenance √©thique et durable", en:"Ethical & Sustainable Maintenance"}, color:"amber", rationale: {fr:"Validez votre approche centr√©e sur le client et la durabilit√©, des comp√©tences de plus en plus recherch√©es.", en:"Validate your customer-centric and sustainability-focused approach, skills that are increasingly in demand."}, syllabus: { fr: ["Module 1: Principes de durabilit√©", "Module 2: Communication transparente", "Module 3: Fin de vie des √©quipements"], en: ["Module 1: Sustainability Principles", "Module 2: Transparent Communication", "Module 3: Equipment End-of-Life"] } },
      { id: "cert-mistral-1", org: "Mistral", emoji: "üá™üá∫", title: {fr:"Expert Normes Europ√©ennes CVC", en:"HVAC European Standards Expert"}, color:"slate", rationale: {fr:"Transformez votre connaissance des normes en un atout certifi√© et reconnu sur le march√© europ√©en.", en:"Turn your knowledge of standards into a certified and recognized asset on the European market."}, syllabus: { fr: ["Module 1: Normes EN 378 & ISO 50001", "Module 2: Application sur site", "Module 3: Veille r√©glementaire"], en: ["Module 1: EN 378 & ISO 50001 Standards", "Module 2: On-site Application", "Module 3: Regulatory Watch"] } },
      { id: "cert-meta-1", org: "Llama", emoji: "üß†", title: {fr:"Technicien CVC en environnement connect√©", en:"HVAC Technician in Connected Environments"}, color:"fuchsia", rationale: {fr:"Faites le pont entre votre m√©tier et le monde de la domotique et de l'IoT.", en:"Bridge the gap between your profession and the world of home automation and IoT."}, syllabus: { fr: ["Module 1: Introduction √† la domotique", "Module 2: Protocoles (Zigbee, Matter)", "Module 3: S√©curit√© des r√©seaux domestiques"], en: ["Module 1: Introduction to Domotics", "Module 2: Protocols (Zigbee, Matter)", "Module 3: Home Network Security"] } }
    ];

    const olmExampleJson = {
      "id": "olm-john-doe-12345",
      "owner": "John Doe",
      "version": "1.0.0",
      "last_updated": "2025-09-30T10:00:00Z",
      "profile": {
        "role": "Plombier / Chauffagiste",
        "status": "En recherche active, ouvert √† la formation"
      },
      "skills": {
        "hard_skills": [
          { "name": "Lecture de plans", "level": 70, "emotion": "Confident" },
          { "name": "Installation sanitaire", "level": 85, "emotion": "Expert" },
          { "name": "Soudure cuivre", "level": 65, "emotion": "Needs Improvement" },
          { "name": "Maintenance chaudi√®res", "level": 78, "emotion": "Confident" },
          { "name": "R√©seaux de chauffage", "level": 60, "emotion": "Anxious" }
        ],
        "soft_skills": [
          { "name": "Relation client", "level": 55, "history": ["Formation 'Communication non-violente'"] },
          { "name": "Travail d'√©quipe", "level": 80, "history": ["Projet collaboratif 'Grand Chantier XYZ'"] },
          { "name": "R√©solution de probl√®mes", "level": 75, "history": ["Intervention d'urgence 'Fuite majeure'"] }
        ]
      },
      "learning_history": {
        "successes": [
          { "description": "R√©paration complexe d'une chaudi√®re industrielle en un temps record.", "skill_gained": "Maintenance chaudi√®res", "points": 5 },
          { "description": "Obtention de la certification 'S√©curit√© Gaz Avanc√©e'.", "skill_gained": "Installation sanitaire", "points": 10 }
        ],
        "failures": [
          { "description": "Difficult√© √† interpr√©ter un plan de r√©seau de chauffage isom√©trique, ayant n√©cessit√© l'aide d'un pair.", "learning_opportunity": "Approfondir la lecture de plans 3D" }
        ]
      },
      "professional_experience": [
        { "company": "Plomberie Durand & Fils", "role": "Apprenti Plombier", "years": "2015-2017" },
        { "company": "Bati-Services Express", "role": "Plombier Chauffagiste", "years": "2017-2024" }
      ],
      "motivations": [
        "Monter en comp√©tence sur les √©nergies renouvelables",
        "Obtenir un poste avec plus de responsabilit√©s",
        "Am√©liorer ma communication avec les clients difficiles"
      ],
      "peers": [
        { "name": "Jane Smith", "relation": "Ancienne coll√®gue", "domain": "Plomberie, sp√©cialis√©e CVC" },
        { "name": "Marc Petit", "relation": "Mentor", "domain": "Chauffagiste expert" }
      ]
    };

    let state = { skills: [], provider: null, logs: [], recos: [], consents: { competences:true, chantiers:true, notes:false, disponibilites:false, objectifs:true }, context: CONTEXTS[0].id, pendingProvider: null, initialSkillsSnapshot: [], lastFocused: null, language: 'fr' };
    let modalKeyListener = null;
    let certModalKeyListener = null;
    let jsonModalKeyListener = null;
    
    const $ = (s) => document.querySelector(s);
    const el = (tag, cls) => { const e=document.createElement(tag); if(cls) e.className=cls; return e; };
    
    function T(key, replacements = {}) {
        let text = translations[state.language][key] || key;
        for (const [placeholder, value] of Object.entries(replacements)) {
            text = text.replace(`{${placeholder}}`, value);
        }
        return text;
    }

    const log = (key, replacements = {}) => { 
        state.logs.push({key, replacements}); 
        renderConsole(); 
    };
    
    function getProviderLogoHtml(name) {
      const commonClasses = "h-8 w-8 object-contain";
      const logos = {
          ChatGPT: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/light/openai.png",
          Gemini: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1280px-Google_Gemini_logo.svg.png",
          Claude: "https://cdn.worldvectorlogo.com/logos/anthropic-1.svg", 
          Mistral: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/mistral-color.png",
          Llama: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Meta_Platforms_Inc._logo_%28cropped%29.svg/2560px-Meta_Platforms_Inc._logo_%28cropped%29.svg.png"
      };
      const url = logos[name] || '';
      return `<img src="${url}" alt="Logo for ${name}" class="${commonClasses}">`;
    }

    const LLM_LIST = ["ChatGPT","Gemini","Claude","Mistral","Llama"];

    function renderLLMButtons(){
      const host = $("#llmButtons"); host.innerHTML = "";
      LLM_LIST.forEach((name) => {
        const btn = el("button", `w-full h-24 px-3 rounded-2xl flex flex-col items-center justify-center gap-2 text-slate-700 font-semibold text-sm bg-white hover:bg-slate-50 border border-slate-200 shadow-sm hover:shadow-md transition-all active:scale-[0.98] focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500`);
        btn.setAttribute("type","button");
        btn.setAttribute("aria-label", T('analyze_with', {provider: name}));
        btn.addEventListener("click", ()=>openConsent(name));
        const iconWrap = el('div', 'h-10 flex items-center justify-center');
        iconWrap.innerHTML = getProviderLogoHtml(name);
        const label = el('span');
        label.textContent = name;
        btn.append(iconWrap, label);
        host.appendChild(btn);
      });
    }
    
    function renderRadar(){
        const host = $("#radar"); host.innerHTML = "";
        if(!state.skills.length){
            host.innerHTML = `<p class="text-sm text-slate-500">${T('radar_placeholder')}</p>`;
            host.className='w-full h-72 flex items-center justify-center';
            return;
        }
        host.className = 'w-full h-72';
        const R=90, cx=140, cy=140, n=state.skills.length;
        const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
        svg.setAttribute("viewBox",`0 0 ${cx*2} ${cy*2}`); svg.setAttribute("class","w-full h-full");
        svg.setAttribute("role","img");
        svg.innerHTML = `<title>Radar des comp√©tences</title><desc>Visualisation des niveaux des comp√©tences pour John Doe</desc>`;

        [25,50,75,100].forEach(val => {
            const r = (val/100) * R;
            const c=document.createElementNS(svg.namespaceURI,"circle");
            c.setAttribute("cx",cx); c.setAttribute("cy",cy); c.setAttribute("r",r);
            c.setAttribute("fill", "none");
            c.setAttribute("class","stroke-slate-200/70");
            svg.appendChild(c);
        });
        for(let i=0;i<n;i++){
            const a= (Math.PI*2*i)/n - Math.PI/2;
            const l=document.createElementNS(svg.namespaceURI,"line");
            l.setAttribute("x1",cx); l.setAttribute("y1",cy);
            l.setAttribute("x2",cx+R*Math.cos(a)); l.setAttribute("y2",cy+R*Math.sin(a));
            l.setAttribute("class","stroke-slate-200/70");
            svg.appendChild(l);
        }
        const pts = state.skills.map((s,i)=>{ const a=(Math.PI*2*i)/n - Math.PI/2; const r=(s.level/100)*R; return `${cx+r*Math.cos(a)},${cy+r*Math.sin(a)}`; }).join(" ");
        const poly = document.createElementNS(svg.namespaceURI,"polygon");
        poly.setAttribute("points", pts);
        poly.setAttribute("class","fill-blue-500/20 stroke-blue-600");
        poly.style.transition = "points 0.5s ease-in-out";
        svg.appendChild(poly);

        state.skills.forEach((s,i)=>{
            const a=(Math.PI*2*i)/n - Math.PI/2;
            const tx=cx+(R+22)*Math.cos(a); const ty=cy+(R+22)*Math.sin(a);
            const t=document.createElementNS(svg.namespaceURI,"text");
            t.setAttribute("x",tx); t.setAttribute("y",ty);
            t.setAttribute("text-anchor","middle"); t.setAttribute("dominant-baseline","middle");
            t.setAttribute("class","text-xs font-medium fill-slate-600");
            t.textContent=s.competency[state.language]; svg.appendChild(t);
        });
        host.appendChild(svg);
    }

    function renderProviderBadge(){
      const badge = $("#providerBadge");
      const objectiveWidget = $("#objectiveWidget");
      if(state.provider){
        badge.innerHTML = `${getProviderLogoHtml(state.provider)} <span class="ml-2">${T('connected_to')} <strong>${state.provider}</strong></span>`;
        badge.classList.remove("hidden");
        badge.classList.add("inline-flex");
        objectiveWidget.classList.remove('hidden');
        $('#objectiveText').textContent = CONTEXTS.find(c => c.id === state.context)?.label[state.language] || '';
        $('#profileTitle').textContent= T('profile_title_user');
      } else {
        badge.classList.add("hidden");
        badge.classList.remove("inline-flex");
        objectiveWidget.classList.add('hidden');
        $('#profileTitle').textContent= T('profile_title_empty');
      }
    }
    
    function renderConsole(){
        const c = $("#console");
        if (state.logs.length === 0) {
            c.innerHTML = `<span class="text-slate-500">${T('console_placeholder')}</span>`;
            return;
        }
        c.innerHTML = state.logs.map(l => {
            let msg = T(l.key, l.replacements)
                         .replace(/‚úî/g, '<span class="text-green-400">‚úî</span>')
                         .replace(/‚öôÔ∏è/g, '<span class="text-yellow-400">‚öôÔ∏è</span>')
                         .replace(/‚ûú/g, '<span class="text-sky-400">‚ûú</span>')
                         .replace(/üéØ/g, '<span class="text-violet-400">üéØ</span>');
            return `<div class="fade-in">${msg}</div>`;
        }).join("");
        c.scrollTop = c.scrollHeight;
    }
    
    function renderRecos(){
      const hint = $("#recoHint"), prov = $("#recoProvider"), grid = $("#recoGrid"), skeletons = $("#recoSkeletons");
      grid.innerHTML = "";
      if(!state.provider){
        hint.classList.remove("hidden"); prov.textContent="";
        skeletons.classList.add("hidden");
        return;
      }
      hint.classList.add("hidden"); prov.textContent = T('challenges_by', {provider: state.provider});
      
      const allRecos = state.recos;

      allRecos.forEach((r, idx) => {
        const cardClasses = {
            idle: "card",
            pending: "border-amber-300 bg-amber-50/50",
            completed: "border-green-300 bg-green-50/50 opacity-70"
        }[r.status];
        
        const card = el("div",`p-5 flex flex-col transition-all duration-300 fade-in ${cardClasses}`);
        card.style.animationDelay = `${idx * 100}ms`;
        
        let buttonHtml = '';
        if (r.status === 'idle') {
            buttonHtml = `<button class="w-full px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold transition-colors" data-reco-id="${r.id}">${T('reco_card_take_challenge')}</button>`;
        } else if (r.status === 'pending') {
            buttonHtml = `<div class="w-full text-center"><p class="text-xs font-semibold text-amber-800">Parcours g√©n√©r√©...</p></div>`;
        } else { // completed
            buttonHtml = `<div class="w-full px-3 py-2 rounded-lg bg-green-600 text-white text-sm font-semibold text-center flex items-center justify-center gap-2"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-11"/></svg>${T('reco_card_completed')}</div>`;
        }
        
        const skillName = (initialSkills.find(s => s.competency.fr === r.skill) || {competency: {}}).competency[state.language] || r.skill;

        card.innerHTML = `
          <div class="flex-1">
            <div class="flex items-start justify-between">
              <h3 class='text-base font-semibold text-slate-900'>${r.title[state.language]}</h3>
              <span class="text-sm font-bold text-green-600 whitespace-nowrap ml-2">${T('reco_card_potential_gain', {delta: r.delta})}</span>
            </div>
            <p class='mt-2 text-xs text-slate-500'>${r.rationale[state.language]}</p>
          </div>
          <div class="mt-4 pt-4 border-t border-slate-200/60 flex items-center justify-between text-xs text-slate-500">
            <span>${T('reco_card_skill')}: <strong>${skillName}</strong></span>
            <span>${T('reco_card_duration')}: <strong>${r.duration}</strong></span>
          </div>
          <div class="mt-4">${buttonHtml}</div>
        `;
        grid.appendChild(card);
      });
      
      grid.querySelectorAll('[data-reco-id]').forEach(button => {
          button.addEventListener('click', () => applyReco(button.dataset.recoId));
      });
    }

    function renderSkillProgress() {
        const host = $("#skillProgress");
        const hint = $("#gainsHint");
        host.innerHTML = "";
        
        if (!state.provider) {
            hint.classList.remove('hidden');
            return;
        }
        hint.classList.add('hidden');
        
        state.skills.forEach((skill, idx) => {
            const initialLevel = state.initialSkillsSnapshot.find(s => s.competency.fr === skill.competency.fr)?.level || 0;
            const currentLevel = skill.level;
            const achievedGain = currentLevel - initialLevel;
            
            const progressElement = el("div", "fade-in");
            progressElement.style.animationDelay = `${idx * 100}ms`;
            
            progressElement.innerHTML = `
                <div class="flex justify-between items-center mb-1.5">
                    <span class="text-sm font-medium text-slate-700">${skill.competency[state.language]}</span>
                    <span class="text-sm font-bold text-slate-800">${T('progress_bar_gain_text', {initial: initialLevel, final: currentLevel, gain: achievedGain})}</span>
                </div>
                <div class="h-2.5 w-full rounded-full progress-bar-bg overflow-hidden flex">
                    <div class="progress-bar-fg h-full" style="width: ${initialLevel}%"></div>
                    <div class="progress-bar-gain h-full" style="width: ${achievedGain}%"></div>
                </div>
            `;
            host.appendChild(progressElement);
        });
    }

    function renderAiInsight() {
        const section = $('#aiInsightSection');
        if (state.provider) {
            $('#aiInsightText').textContent = PROVIDERS[state.provider].insight[state.language] || "No summary available.";
            section.classList.remove('hidden');
            section.classList.add('fade-in');
        } else {
            section.classList.add('hidden');
        }
    }
    
    function renderCertifications() {
        const grid = $("#certGrid");
        const hint = $("#certHint");
        grid.innerHTML = "";
        if (!state.provider) {
            hint.classList.remove('hidden');
            return;
        }
        hint.classList.add('hidden');
        
        const providerOrgMap = { 'ChatGPT': 'ChatGPT', 'Gemini': 'Gemini', 'Claude': 'Claude', 'Mistral': 'Mistral', 'Llama': 'Llama' };
        const org = providerOrgMap[state.provider];
        const filteredCerts = CERTIFICATIONS.filter(c => c.org === org);

        filteredCerts.forEach((c, idx) => {
            const card = el('div',`card p-5 flex flex-col cursor-pointer`);
            card.dataset.certId = c.id;
            card.style.animationDelay = `${idx * 100}ms`;
            card.innerHTML = `
                <div class="flex items-center gap-4">
                    <span class="text-3xl">${c.emoji}</span>
                    <div>
                        <h4 class="font-semibold text-slate-900">${c.title[state.language]}</h4>
                        <p class="text-xs text-slate-600">Organisme : ${c.org}</p>
                    </div>
                </div>
                <p class="mt-3 text-sm text-slate-700/90 flex-1">${c.rationale[state.language]}</p>
                <div class="mt-4">
                    <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium bg-blue-100 text-blue-800">Passeport disponible</span>
                </div>
            `;
            grid.appendChild(card);
        });

        grid.addEventListener('click', (e) => {
            const card = e.target.closest('[data-cert-id]');
            if (card) {
                openCertModal(card.dataset.certId);
            }
        });
    }
    
    function getFocusable(container){ return container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'); }

    function renderContextOptions() {
      const sel = $("#contextSelect");
      sel.innerHTML = "";
      CONTEXTS.forEach(c => {
        const o = document.createElement("option");
        o.value = c.id;
        o.textContent = c.label[state.language];
        sel.appendChild(o);
      });
      sel.value = state.context;
    }

    function openConsent(name){
      state.pendingProvider = name; state.lastFocused = document.activeElement;
      $('#modalTitle').innerHTML = `${T('modal_title')} <span class="flex items-center gap-2 font-semibold">${getProviderLogoHtml(name)} ${name}</span>`;

      const cons = $("#consents"); cons.innerHTML = "";
      const options = [{ key:"competences", label:"Comp√©tences actuelles" }, { key:"chantiers", label:"Historique de recherches" }, { key:"notes", label:"Notes personnelles" }, { key:"disponibilites", label:"Disponibilit√©s" }, { key:"objectifs", label:"Objectifs professionnels" }];
      options.forEach(opt => {
        const id = `consent_${opt.key}`;
        const row = el("div","flex items-center gap-3");
        row.innerHTML = `<input type="checkbox" id="${id}" ${state.consents[opt.key] ? 'checked' : ''} class="h-4 w-4 rounded border-slate-400 text-blue-600 focus:ring-blue-500">
                         <label for="${id}" class="text-slate-800">${opt.label}</label>`;
        row.querySelector('input').addEventListener('change', e=> state.consents[opt.key] = e.target.checked);
        cons.appendChild(row);
      });
      
      renderContextOptions();
      $("#contextSelect").onchange = e => state.context = e.target.value;

      $("#addContextBtn").onclick = () => {
        const newContextLabel = prompt(T('add_context_prompt'));
        if (newContextLabel && newContextLabel.trim() !== "") {
          const newContextId = `custom_${Date.now()}`;
          CONTEXTS.push({ id: newContextId, label: {fr: newContextLabel.trim(), en: newContextLabel.trim()} });
          state.context = newContextId;
          renderContextOptions();
        }
      };

      const m = $("#modal"); m.classList.remove('hidden'); m.classList.add('flex');
      const focusables = getFocusable(m), first = focusables[0], last = focusables[focusables.length-1];
      first?.focus();
      
      modalKeyListener = (e) => {
          if(e.key === 'Tab'){
              if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
              else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
          } else if(e.key === 'Escape') closeModal();
      };
      m.addEventListener('keydown', modalKeyListener);

      m.querySelectorAll('[data-close]').forEach(b=> b.onclick = closeModal);
      $("#authorizeBtn").onclick = ()=>{ closeModal(); connectTo(state.pendingProvider); };
    }

    function closeModal(){
      const m=$("#modal");
      m.classList.add('hidden'); m.classList.remove('flex');
      if (modalKeyListener) {
        m.removeEventListener('keydown', modalKeyListener);
        modalKeyListener = null;
      }
      state.lastFocused?.focus();
    }

    function openCertModal(certId) {
        const cert = CERTIFICATIONS.find(c => c.id === certId);
        if (!cert) return;
        
        state.lastFocused = document.activeElement;
        const m = $("#certModal");
        
        $('#certModalTitle').textContent = T('cert_modal_title', { title: cert.title[state.language] });
        $('#certModalSubtitle').textContent = T('cert_modal_subtitle', { agent: state.provider });
        $('#certModalRationale').textContent = cert.rationale[state.language];

        const syllabusContainer = $('#certSyllabusContainer');
        const syllabusList = $('#certSyllabusList');
        const viewSyllabusBtn = $('#viewSyllabusBtn');
        const addCertBtn = $('#addCertToAgentBtn');
        
        syllabusContainer.classList.add('hidden');
        syllabusList.innerHTML = cert.syllabus[state.language].map(item => `<li>${item}</li>`).join('');
        viewSyllabusBtn.textContent = T('cert_modal_syllabus_btn');
        addCertBtn.textContent = T('cert_modal_add_btn');

        viewSyllabusBtn.onclick = () => {
            const isHidden = syllabusContainer.classList.toggle('hidden');
            viewSyllabusBtn.textContent = isHidden ? T('cert_modal_syllabus_btn') : T('cert_modal_syllabus_btn_hide');
        };

        addCertBtn.onclick = () => {
            const notice = $('#recoNotice');
            notice.textContent = T('cert_added_notice', {agent: state.provider});
            notice.classList.remove('hidden');
            setTimeout(() => notice.classList.add('hidden'), 5000);
            closeCertModal();
        };

        m.classList.remove('hidden'); m.classList.add('flex');
        const focusables = getFocusable(m), first = focusables[0], last = focusables[focusables.length - 1];
        first?.focus();

        certModalKeyListener = (e) => {
            if (e.key === 'Escape') closeCertModal();
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); } 
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        };
        m.addEventListener('keydown', certModalKeyListener);
        m.querySelectorAll('[data-cert-close]').forEach(b => b.onclick = closeCertModal);
    }

    function closeCertModal() {
        const m = $("#certModal");
        m.classList.add('hidden'); m.classList.remove('flex');
        if (certModalKeyListener) {
            m.removeEventListener('keydown', certModalKeyListener);
            certModalKeyListener = null;
        }
        state.lastFocused?.focus();
    }

    function openJsonModal() {
        state.lastFocused = document.activeElement;
        const m = $("#jsonModal");
        $('#jsonContent').textContent = JSON.stringify(olmExampleJson, null, 2);

        m.classList.remove('hidden');
        m.classList.add('flex');
        const focusables = getFocusable(m), first = focusables[0], last = focusables[focusables.length-1];
        first?.focus();

        jsonModalKeyListener = (e) => {
            if (e.key === 'Escape') closeJsonModal();
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        };
        m.addEventListener('keydown', jsonModalKeyListener);
        m.querySelectorAll('[data-json-close]').forEach(b => b.onclick = closeJsonModal);
    }

    function closeJsonModal() {
        const m = $("#jsonModal");
        m.classList.add('hidden');
        m.classList.remove('flex');
        if (jsonModalKeyListener) {
            m.removeEventListener('keydown', jsonModalKeyListener);
            jsonModalKeyListener = null;
        }
        state.lastFocused?.focus();
    }
    
    async function connectTo(name){
      state.provider = name; 
      state.logs = []; 
      state.recos = [];
      state.skills = JSON.parse(JSON.stringify(initialSkills));
      state.initialSkillsSnapshot = JSON.parse(JSON.stringify(initialSkills));

      $("#recoSkeletons").classList.remove("hidden");
      $("#recoGrid").innerHTML = ''; 
      $("#certGrid").innerHTML = '';
      $('#aiInsightSection').classList.add('hidden');

      log("log_connecting");
      log("log_connection_request", {provider: name});
      await new Promise(r=>setTimeout(r,300));
      log("log_handshake_ok");
      const granted = Object.entries(state.consents).filter(([,v])=>v).map(([k])=>k).join(", ") || "(aucune)";
      log("log_consent", {granted});
      await new Promise(r=>setTimeout(r,400));
      
      const context = CONTEXTS.find(c => c.id === state.context);
      if (context) {
        log("log_objective", {context: context.label[state.language]});
      }
      await new Promise(r=>setTimeout(r,500));
      
      const conf = PROVIDERS[name];
      log("log_analysis", {count: conf.deltas.length});
      conf.deltas.forEach(d=>{
          const skillToUpdate = state.skills.find(s => s.competency.fr === d.skill);
          if(skillToUpdate) skillToUpdate.level = Math.min(100, skillToUpdate.level + d.delta);
          log("log_skill_gain", {skill: d.skill, delta: d.delta, why: d.why});
      });
      await new Promise(r=>setTimeout(r,500));
      log("log_recos_generated");
      state.recos = conf.recos.map((r,i)=> ({ id: `${name}-${i}`, status: 'idle', ...r }));

      $("#recoSkeletons").classList.add("hidden");
      renderAll();
    }

    function applyReco(id) {
        const rec = state.recos.find(r => r.id === id);
        if (!rec || rec.status !== 'idle') return;
        
        rec.status = 'pending';
        
        const notice = $('#recoNotice');
        notice.textContent = T('reco_notice_success', {provider: state.provider});
        notice.classList.remove('hidden');
        setTimeout(() => notice.classList.add('hidden'), 5000);

        renderAll();

        setTimeout(() => {
            completeReco(id);
        }, 2500);
    }

    function completeReco(id) {
        const rec = state.recos.find(r => r.id === id);
        if (!rec || rec.status !== 'pending') return;
        
        let skillToUpdate = state.skills.find(s => s.competency.fr === rec.skill);

        if (skillToUpdate) {
            skillToUpdate.level = Math.min(100, skillToUpdate.level + rec.delta);
        } else {
            const newSkillName = {fr: rec.skill, en: rec.skill};
            const newSkill = { competency: newSkillName, level: rec.delta };
            state.skills.push(newSkill);
            state.initialSkillsSnapshot.push({ competency: newSkillName, level: 0 });
            log("log_new_skill", {skill: rec.skill});
        }
        
        rec.status = 'completed';
        log("log_challenge_complete", {title: rec.title[state.language], delta: rec.delta, skill: rec.skill});
        renderAll();
    }
    
    function updateUI(lang) {
        if (!['fr', 'en'].includes(lang)) return;
        state.language = lang;
        document.documentElement.lang = lang;

        document.querySelectorAll('[data-translate-key]').forEach(el => {
            el.innerHTML = T(el.dataset.translateKey);
        });

        document.getElementById('lang-fr').classList.toggle('active', lang === 'fr');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        renderAll();
    }

    function reset(){ 
      state.skills = [];
      state.provider = null;
      state.logs = [];
      state.recos = [];
      state.initialSkillsSnapshot = [];
      $('#recoNotice').classList.add('hidden');
      renderAll();
    }
    
    function renderAll(){
      renderLLMButtons();
      renderRadar();
      renderProviderBadge();
      renderConsole();
      renderRecos();
      renderSkillProgress();
      renderAiInsight();
      renderCertifications();
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        $('#resetBtn').addEventListener('click', reset);
        $('#lang-fr').addEventListener('click', () => updateUI('fr'));
        $('#lang-en').addEventListener('click', () => updateUI('en'));
        $('#showJsonBtn').addEventListener('click', openJsonModal);

        updateUI(state.language);
    });
  </script>
</body>
</html>
