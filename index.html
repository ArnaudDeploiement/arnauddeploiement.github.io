<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Votre OLM : Le futur de l'apprentissage personnalis√©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --c-indigo-50: #eef2ff; --c-indigo-100: #e0e7ff; --c-indigo-600: #4f46e5; --c-indigo-800: #3730a3;
      --c-slate-50: #f8fafc; --c-slate-100: #f1f5f9; --c-slate-200: #e2e8f0; --c-slate-400: #94a3b8; --c-slate-500: #64748b; --c-slate-600: #475569; --c-slate-700: #334155; --c-slate-800: #1e293b; --c-slate-900: #0f172a;
    }
    :focus-visible { outline: 2px solid #6366f1; outline-offset: 2px; }
    svg { shape-rendering: geometricPrecision; text-rendering: geometricPrecision; }
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
    }
    .card-3d:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 10px 20px rgba(0,0,0,0.07), 0 4px 6px rgba(0,0,0,0.05);
    }
    .console-log-gain { color: #22c55e; }
    .console-log-info { color: #38bdf8; }
    .console-log-warn { color: #f59e0b; }
    .console-log-goal { color: #a78bfa; }
    .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .gradient-text { background: linear-gradient(to right, var(--c-indigo-600), var(--c-slate-700)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .progress-bar-bg { background-color: #e5e7eb; }
    .progress-bar-fg { background-color: #4f46e5; transition: width 0.5s ease-in-out; }
    .progress-bar-potential { background-color: #a7f3d0; transition: width 0.5s ease-in-out; }
    .progress-bar-gain { background-color: #10b981; transition: width 0.5s ease-in-out; }
    .lang-btn.active { font-weight: 700; color: var(--c-indigo-600); text-decoration: underline; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-700 antialiased">
  
  <div class="absolute top-4 right-4 z-10">
    <div class="flex items-center gap-1 text-sm font-medium text-slate-500">
        <button id="lang-fr" class="lang-btn px-2 py-1 rounded hover:text-slate-800">FR</button>
        <span>|</span>
        <button id="lang-en" class="lang-btn px-2 py-1 rounded hover:text-slate-800">EN</button>
    </div>
  </div>

  <header class="max-w-7xl mx-auto px-6 py-12 md:py-16 text-center">
    <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight gradient-text" data-translate-key="title"></h1>
    <p class="mt-2 text-xs md:text-sm text-slate-500 italic" data-translate-key="subtitle"></p>
    <p class="mt-6 text-sm md:text-base max-w-3xl mx-auto text-justify" data-translate-key="intro_p1"></p>

    <div class="mt-8 rounded-2xl border border-indigo-200 bg-indigo-50/50 p-6 text-left max-w-4xl mx-auto">
      <h2 class="text-base md:text-lg font-semibold text-indigo-800 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.5 2H8.6c-.4 0-.8.2-1.1.5-.3.3-.5.7-.5 1.1v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z"></path><polyline points="14,2 14,8 20,8"></polyline><path d="M12 18v-6"></path><path d="m9 15 3-3 3 3"></path></svg>
        <span data-translate-key="how_it_works_title"></span>
      </h2>
      <ul class="mt-3 space-y-1.5 text-xs md:text-sm text-slate-700">
        <li data-translate-key="how_it_works_step1"></li>
        <li data-translate-key="how_it_works_step2"></li>
        <li data-translate-key="how_it_works_step3"></li>
        <li data-translate-key="how_it_works_step4"></li>
      </ul>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 grid lg:grid-cols-3 gap-8">
    <section class="lg:col-span-2 border border-slate-200/80 bg-white rounded-2xl shadow-sm card-3d transition-all duration-300" aria-labelledby="profil-title">
      <div class="p-5 border-b border-slate-200/80 flex justify-between items-start">
        <div>
            <h3 id="profil-title" class="text-base font-semibold flex items-center gap-2 text-slate-800">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M15.5 13.5c-.4-.4-.8-1.2-1-2.5a2.5 2.5 0 0 0-5 0c-.2 1.3-.6 2-1 2.5"/><path d="M12 12h.01"/></svg>
                <span id="profileTitle" data-translate-key="profile_title_empty"></span>
            </h3>
            <span id="providerBadge" class="mt-1 hidden text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 font-medium"></span>
        </div>
        <div id="objectiveWidget" class="hidden text-right">
            <p class="text-xs text-slate-500" data-translate-key="objective_widget_title"></p>
            <p id="objectiveText" class="text-sm font-semibold text-indigo-700"></p>
        </div>
      </div>
      <div class="p-5">
        <div id="radar" class="w-full h-64 flex items-center justify-center text-sm text-slate-500" data-translate-key="radar_placeholder"></div>
        <div id="skillBadges" class="mt-3 flex flex-wrap gap-2"></div>
        <div id="skillsTableWrap" class="mt-3 hidden">
          <h4 class="sr-only" data-translate-key="skills_list_sr"></h4>
          <ul id="skillsList" class="text-xs text-slate-600 list-disc pl-5"></ul>
        </div>
      </div>
    </section>

    <section class="border border-slate-200/80 bg-white rounded-2xl shadow-sm card-3d transition-all duration-300" aria-labelledby="console-title">
      <div class="p-5 border-b border-slate-200/80"><h3 id="console-title" class="text-base font-semibold flex items-center gap-2 text-slate-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 17_10 7l6 10-6-10z"></path><path d="M12 19h10"></path></svg>
        <span data-translate-key="console_title"></span></h3></div>
      <div class="p-5">
        <div id="console" class="bg-slate-900 text-sky-200 text-[11px] rounded-lg p-3 h-96 overflow-auto font-mono"
             aria-live="polite"></div>
        <div class="mt-3 flex gap-2">
          <button id="resetBtn" class="px-3 py-1.5 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-xs font-medium" data-translate-key="reset_btn"></button>
        </div>
      </div>
    </section>

    <section class="lg:col-span-3 pt-6 pb-2" aria-labelledby="llm-connect-title">
      <h2 id="llm-connect-title" class="text-lg font-semibold text-slate-800" data-translate-key="connect_agent_title"></h2>
      <p class="mt-2 text-slate-600 text-sm" data-translate-key="connect_agent_subtitle"></p>
      <nav aria-label="Fournisseurs LLM" class="mt-4">
        <div id="llmButtons" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 max-w-5xl mx-auto"></div>
      </nav>
    </section>
    
    <section id="aiInsightSection" class="lg:col-span-3 hidden" aria-labelledby="ai-insight-title">
         <div class="border border-indigo-200/80 bg-indigo-50/50 rounded-2xl shadow-sm p-5">
            <h3 id="ai-insight-title" class="text-base font-semibold text-indigo-800 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                <span data-translate-key="ai_insight_title"></span>
            </h3>
            <p id="aiInsightText" class="mt-2 text-sm text-slate-700"></p>
         </div>
    </section>

    <section class="lg:col-span-3 py-2" aria-labelledby="reco-title">
      <h2 id="reco-title" class="text-lg font-semibold text-slate-800"><span data-translate-key="challenges_title"></span> <span id="recoProvider" class="text-slate-500 font-normal"></span></h2>
      <p id="recoHint" class="mt-2 text-slate-600 text-sm" data-translate-key="challenges_placeholder"></p>
      <div id="recoNotice" class="hidden mt-3 rounded-xl border border-emerald-200 bg-emerald-50 text-emerald-800 text-sm px-4 py-3" aria-live="polite"></div>

      <div id="recoSkeletons" class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
        <div class="h-44 rounded-2xl bg-slate-200 animate-pulse"></div>
        <div class="h-44 rounded-2xl bg-slate-200 animate-pulse"></div>
        <div class="h-44 rounded-2xl bg-slate-200 animate-pulse lg:block hidden"></div>
      </div>

      <div id="recoGrid" class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      <div class="mt-4 hidden" id="applyAllWrap">
        <button id="applyAllBtn" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold disabled:opacity-60 disabled:cursor-not-allowed transition-colors">
          <span data-translate-key="apply_all_btn"></span> (<span id="applyCount">0</span>)
        </button>
      </div>
    </section>

    <section class="lg:col-span-3 py-2" aria-labelledby="gains-title">
      <h2 id="gains-title" class="text-lg font-semibold text-slate-800" data-translate-key="progress_title"></h2>
      <p id="gainsHint" class="mt-2 text-slate-600 text-sm" data-translate-key="progress_placeholder"></p>
      <div id="skillProgress" class="mt-4 grid md:grid-cols-2 gap-x-8 gap-y-4"></div>
    </section>

    <section id="certSection" class="lg:col-span-3 py-2" aria-labelledby="cert-title">
        <h2 id="cert-title" class="text-lg font-semibold text-slate-800" data-translate-key="certifications_title"></h2>
        <p id="certHint" class="mt-2 text-slate-600 text-sm" data-translate-key="certifications_placeholder"></p>
        <div id="certGrid" class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>
  </main>

  <section class="max-w-7xl mx-auto px-6 py-12 grid md:grid-cols-3 gap-6">
    <article class="border border-slate-200/80 bg-white rounded-2xl shadow-sm p-5 card-3d transition-all duration-300">
        <h3 class="text-base font-semibold flex items-center gap-2" data-translate-key="what_is_olm_title"></h3>
        <p class="mt-2 text-sm text-slate-700" data-translate-key="what_is_olm_p"></p>
    </article>
    <article class="border border-slate-200/80 bg-white rounded-2xl shadow-sm p-5 card-3d transition-all duration-300">
        <h3 class="text-base font-semibold flex items-center gap-2" data-translate-key="why_mcp_title"></h3>
        <p class="mt-2 text-sm text-slate-700" data-translate-key="why_mcp_p"></p>
    </article>
    <article class="border border-slate-200/80 bg-white rounded-2xl shadow-sm p-5 card-3d transition-all duration-300">
        <h3 class="text-base font-semibold flex items-center gap-2" data-translate-key="design_fiction_title"></h3>
        <p class="mt-2 text-sm text-slate-700" data-translate-key="design_fiction_p"></p>
    </article>
  </section>

  <div id="modal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="absolute inset-0 bg-black/50" data-close></div>
    <div class="relative bg-white rounded-2xl shadow-xl max-w-2xl w-full">
      <div class="p-6">
        <h2 id="modalTitle" class="text-lg font-semibold text-slate-800"><span data-translate-key="modal_title"></span><span id="modalProvider"></span></h2>
        <p class="mt-1 text-sm text-slate-600" data-translate-key="modal_subtitle"></p>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <fieldset class="border border-slate-200 rounded-lg p-4">
            <legend class="px-2 text-sm font-medium text-slate-700" data-translate-key="modal_data_title"></legend>
            <div id="consents" class="mt-2 space-y-3 text-sm"></div>
          </fieldset>

          <fieldset class="border border-slate-200 rounded-lg p-4 flex flex-col">
            <legend class="px-2 text-sm font-medium text-slate-700" data-translate-key="modal_objective_title"></legend>
            <div class="flex-1">
              <label for="contextSelect" class="sr-only" data-translate-key="modal_objective_select_sr"></label>
              <select id="contextSelect" class="mt-2 w-full border border-slate-300 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 focus:ring-indigo-500"></select>
              <p class="mt-2 text-xs text-slate-500" data-translate-key="modal_objective_p"></p>
            </div>
            <button id="addContextBtn" type="button" class="mt-3 text-sm font-semibold text-indigo-600 hover:text-indigo-800 transition-colors self-start" data-translate-key="modal_add_context_btn"></button>
          </fieldset>
        </div>

        <div class="mt-6 flex items-center justify-end gap-3">
          <button type="button" class="px-4 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-sm font-semibold" data-close data-translate-key="modal_cancel_btn"></button>
          <button id="authorizeBtn" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold" data-translate-key="modal_authorize_btn"></button>
        </div>
      </div>
    </div>
  </div>

  <div id="certModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="certModalTitle">
        <div class="absolute inset-0 bg-black/50" data-cert-close></div>
        <div class="relative bg-white rounded-2xl shadow-xl max-w-lg w-full">
            <div class="p-6">
                <h2 id="certModalTitle" class="text-lg font-semibold text-slate-800"></h2>
                <p id="certModalSubtitle" class="mt-1 text-sm text-slate-500"></p>

                <div class="mt-4 inline-flex items-center gap-2 rounded-full bg-blue-100 text-blue-800 px-3 py-1 text-xs font-semibold">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    <span data-translate-key="cert_modal_recognized"></span>
                </div>

                <p id="certModalRationale" class="mt-4 text-sm text-slate-600"></p>

                <div id="certSyllabusContainer" class="mt-4 hidden border-t border-slate-200 pt-4">
                    <h4 class="text-sm font-semibold text-slate-700" data-translate-key="cert_modal_syllabus_title"></h4>
                    <ul id="certSyllabusList" class="mt-2 text-sm text-slate-600 list-disc list-inside space-y-1"></ul>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row-reverse gap-3">
                    <button id="addCertToAgentBtn" class="w-full px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold"></button>
                    <button id="viewSyllabusBtn" class="w-full px-4 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 text-sm font-semibold"></button>
                </div>
            </div>
        </div>
    </div>


  <footer class="border-t border-slate-200 mt-10">
    <div class="max-w-7xl mx-auto px-6 py-6 text-xs text-slate-600 text-center" data-translate-key="footer">
    </div>
  </footer>

  <script>
    // SCRIPT START
    const translations = {
        fr: {
            title: "Ma√Ætrisez votre parcours avec votre OLM",
            subtitle: "Une design fiction par <strong>Arnaud Guiovanna</strong> explorant le futur de l'apprentissage.",
            intro_p1: "Un Open Learner Model (OLM) est un profil d‚Äôapprentissage num√©rique et portable qui regroupe vos comp√©tences, niveaux, objectifs et preuves (travaux, √©valuations, exp√©riences). Con√ßu pour √™tre interop√©rable et contr√¥l√© par l‚Äôapprenant, il permet de mesurer vos acquis, d‚Äôorienter vos parcours et de partager vos donn√©es de fa√ßon s√©curis√©e entre diff√©rents outils. Bien plus qu'un CV, il agr√®ge dynamiquement ce qui vous rend unique : vos <strong>comp√©tences techniques</strong> (certifications, projets r√©ussis), vos <strong>soft skills</strong> (collaboration, gestion du stress) et m√™me vos <strong>m√©thodes d'apprentissage</strong> (votre fa√ßon de r√©soudre les probl√®mes).<br><br>Sa force est l'<strong>interop√©rabilit√©</strong> : vous gardez le contr√¥le total et pouvez le connecter √† n'importe quel agent IA pour transformer un objectif de carri√®re en un parcours sur-mesure.<br><br><strong>Votre mission :</strong> incarnez <strong>John Doe</strong>, connectez son OLM √† l'IA de votre choix et simulez la cr√©ation de son plan de progression.<br><i>(Toutes les donn√©es sont fictives.)</i>",            how_it_works_title: "Comment fonctionne cette d√©mo ?",
            how_it_works_step1: "<strong>1. Connectez un agent IA :</strong> Choisissez un LLM pour analyser le profil de John.",
            how_it_works_step2: "<strong>2. Choisissez un objectif :</strong> Indiquez √† l'IA le contexte pour lequel vous voulez vous am√©liorer.",
            how_it_works_step3: "<strong>3. D√©couvrez les d√©fis :</strong> L'IA g√©n√®re des d√©fis et une synth√®se pour atteindre votre objectif.",
            how_it_works_step4: "<strong>4. Suivez vos progr√®s :</strong> Relevez les d√©fis et visualisez la mise √† jour de votre profil OLM.",
            profile_title_empty: "Profil OLM",
            profile_title_user: "Profil OLM ‚Äî John Doe",
            connected_to: "Connect√© √† {provider}",
            objective_widget_title: "Objectif actuel",
            radar_placeholder: "Choisissez un agent IA pour lancer une analyse.",
            skills_list_sr: "Liste des comp√©tences",
            console_title: "Console d'activit√©",
            console_placeholder: "En attente de connexion...",
            reset_btn: "R√©initialiser",
            connect_agent_title: "Connectez un Agent IA",
            connect_agent_subtitle: "Choisissez un agent pour analyser votre OLM et g√©n√©rer des recommandations personnalis√©es.",
            analyze_with: "Analyser avec {provider}",
            ai_insight_title: "Synth√®se de l'Agent IA",
            challenges_title: "Vos d√©fis d‚Äôapprentissage",
            challenges_by: "‚Äî g√©n√©r√©s par {provider}",
            challenges_placeholder: "Lancez une analyse pour d√©couvrir des d√©fis personnalis√©s.",
            reco_notice_success: "‚úÖ Parcours g√©n√©r√© dans {provider}. La progression ci-dessous simule votre gain potentiel en cas de succ√®s.",
            apply_all_btn: "Relever tous les d√©fis",
            progress_title: "Progression des Comp√©tences",
            progress_placeholder: "Visualisez l'√©volution de vos comp√©tences apr√®s chaque d√©fi.",
            certifications_title: "Passerelles de certification",
            certifications_placeholder: "Connectez votre OLM √† un agent pour obtenir des suggestions de certifications pertinentes.",
            what_is_olm_title: "üß† Qu‚Äôest-ce qu‚Äôun OLM ?",
            what_is_olm_p: "Un <strong>Open Learner Model</strong> est un profil d'apprentissage portable et contr√¥l√© par l'utilisateur. Il contient vos comp√©tences, objectifs et preuves. C'est votre jumeau num√©rique, con√ßu pour l'interop√©rabilit√©.",
            why_mcp_title: "üîó Bas√© sur le Protocole MCP",
            why_mcp_p: "Le <strong>Model Context Protocol (MCP)</strong> est la norme qui permet √† votre Open Learner Model (OLM) de dialoguer de mani√®re standardis√©e et s√©curis√©e avec n'importe quel LLM. C'est gr√¢ce √† ce protocole que votre profil est v√©ritablement <strong>interop√©rable</strong>.",
            design_fiction_title: "üí° Ceci est un design fiction",
            design_fiction_p: "Cette maquette explore un futur possible o√π chaque apprenant peut cr√©er son OLM, contr√¥le ses donn√©es et fait reconna√Ætre ses apprentissages, ind√©pendamment des plateformes.",
            modal_title: "Autoriser la connexion : OLM ‚ûú ",
            modal_subtitle: "Partagez vos donn√©es et choisissez le contexte que vous souhaitez am√©liorer.",
            modal_data_title: "Donn√©es √† partager",
            modal_objective_title: "Objectif d'am√©lioration",
            modal_objective_select_sr: "S√©lectionnez un contexte",
            modal_objective_p: "L'agent IA adaptera ses recommandations √† cet objectif.",
            modal_add_context_btn: "+ Ajouter un contexte",
            modal_cancel_btn: "Annuler",
            modal_authorize_btn: "Autoriser & Lancer l'analyse",
            footer: "‚ú® Design fiction propos√© par Arnaud Guiovanna ‚Ä¢ 2025",
            log_connecting: "‚öôÔ∏è Connexion s√©curis√©e √† l'agent IA...",
            log_connection_request: "OLM ‚ûú Demande de connexion √† {provider}",
            log_handshake_ok: "Handshake MCP 1.0 : OK",
            log_consent: "Consentement ‚ûú Donn√©es partag√©es : {granted}",
            log_objective: "üéØ Objectif transmis √† l'agent : Am√©liorer les comp√©tences pour \"{context}\".",
            log_analysis: "Analyse OLM ‚ûú {count} gains potentiels identifi√©s √† partir de l'historique.",
            log_skill_gain: "‚úî Gain de comp√©tence : {skill} (+{delta}) | source: {why}",
            log_recos_generated: "‚úî Recommandations g√©n√©r√©es, pr√™tes √† √™tre explor√©es.",
            log_challenge_complete: "‚úî D√©fi relev√© : \"{title}\" (+{delta} {skill})",
            log_new_skill: "‚ú® Nouvelle comp√©tence ajout√©e au profil : \"{skill}\"",
            reco_card_skill: "Comp√©tence",
            reco_card_duration: "Dur√©e",
            reco_card_completed: "Termin√©",
            reco_card_pending: "Parcours g√©n√©r√© (en attente)",
            reco_card_potential_gain: "+{delta} pts (gain potentiel)",
            reco_card_potential_gain_short: "potentiel",
            reco_card_take_challenge: "Relever le d√©fi",
            progress_bar_gain_text: "{initial} ‚ûú {final} (+{gain})",
            add_context_prompt: "Entrez le nom de votre nouveau contexte d'am√©lioration :",
            reco_notice_update: "‚úÖ Comp√©tence \"{skill}\" mise √† jour dans votre profil.",
            cert_modal_title: "Certification : {title}",
            cert_modal_subtitle: "Propos√©e par votre agent {agent}",
            cert_modal_recognized: "Reconnu par le Minist√®re du Travail",
            cert_modal_add_btn: "Ajouter √† mon agent",
            cert_modal_syllabus_btn: "Voir le syllabus",
            cert_modal_syllabus_btn_hide: "Masquer le syllabus",
            cert_modal_syllabus_title: "Programme de la certification",
            cert_added_notice: "‚úÖ Le parcours de certification a √©t√© ajout√© √† votre agent {agent}.",
        },
        en: {
            title: "Master Your Journey with Your OLM",
            subtitle: "A design fiction by <strong>Arnaud Guiovanna</strong> exploring the future of learning.",
            intro_p1: "You are <strong>John Doe</strong>, an experienced heating engineer looking to upskill. Your OLM, a true digital twin of your skills, is ready. Your mission: connect it to an AI agent, choose a career objective (like preparing for an interview), and discover the personalized learning paths the AI suggests to achieve it. <i>(All data is fictitious, no real connection is made.)</i>",
            how_it_works_title: "How does this demo work?",
            how_it_works_step1: "<strong>1. Connect an AI Agent:</strong> Choose an LLM to analyze John's profile.",
            how_it_works_step2: "<strong>2. Choose an Objective:</strong> Tell the AI the context you want to improve for.",
            how_it_works_step3: "<strong>3. Discover Challenges:</strong> The AI generates personalized challenges and a summary to reach your goal.",
            how_it_works_step4: "<strong>4. Track Your Progress:</strong> Complete challenges and see your OLM profile update in real-time.",
            profile_title_empty: "OLM Profile",
            profile_title_user: "OLM Profile ‚Äî John Doe",
            connected_to: "Connected to {provider}",
            objective_widget_title: "Current Objective",
            radar_placeholder: "Choose an AI agent to start an analysis.",
            skills_list_sr: "Skills List",
            console_title: "Activity Console",
            console_placeholder: "Waiting for connection...",
            reset_btn: "Reset",
            connect_agent_title: "Connect an AI Agent",
            connect_agent_subtitle: "Choose an agent to analyze your OLM and generate personalized recommendations.",
            analyze_with: "Analyze with {provider}",
            ai_insight_title: "AI Agent Summary",
            challenges_title: "Your Learning Challenges",
            challenges_by: "‚Äî generated by {provider}",
            challenges_placeholder: "Start an analysis to discover personalized challenges.",
            reco_notice_success: "‚úÖ A learning path has been generated in your {provider} agent. Complete it to validate these gains.",
            apply_all_btn: "Complete all challenges",
            progress_title: "Skill Progression",
            progress_placeholder: "Visualize your skill development after each challenge.",
            certifications_title: "Certification Pathways",
            certifications_placeholder: "Connect your OLM to an agent to get relevant certification suggestions.",
            what_is_olm_title: "üß† What is an OLM?",
            what_is_olm_p: "An <strong>Open Learner Model</strong> is a portable, user-controlled learning profile. It holds your skills, goals, and evidence. It's your digital twin, designed for interoperability.",
            why_mcp_title: "üîó Based on the MCP Protocol",
            why_mcp_p: "The <strong>Model Context Protocol (MCP)</strong> is the standard that allows your Open Learner Model (OLM) to communicate in a standardized and secure way with any LLM. This protocol is what makes your skill profile truly <strong>interoperable</strong>.",
            design_fiction_title: "üí° This is a Design Fiction",
            design_fiction_p: "This prototype explores a possible future where every learner can create their OLM, control their data, and have their learning recognized, regardless of the platform.",
            modal_title: "Authorize Connection: OLM ‚ûú ",
            modal_subtitle: "Share your data and choose the context you want to improve.",
            modal_data_title: "Data to Share",
            modal_objective_title: "Improvement Objective",
            modal_objective_select_sr: "Select a context",
            modal_objective_p: "The AI agent will tailor its recommendations to this objective.",
            modal_add_context_btn: "+ Add new context",
            modal_cancel_btn: "Cancel",
            modal_authorize_btn: "Authorize & Start Analysis",
            footer: "‚ú® Design fiction by Arnaud Guiovanna ‚Ä¢ 2025",
            log_connecting: "‚öôÔ∏è Securely connecting to AI agent...",
            log_connection_request: "OLM ‚ûú Connection request to {provider}",
            log_handshake_ok: "MCP 1.0 Handshake: OK",
            log_consent: "Consent ‚ûú Shared data: {granted}",
            log_objective: "üéØ Objective sent to agent: Upskill for \"{context}\".",
            log_analysis: "OLM Analysis ‚ûú {count} potential gains identified from history.",
            log_skill_gain: "‚úî Skill gain: {skill} (+{delta}) | source: {why}",
            log_recos_generated: "‚úî Recommendations generated, ready to be explored.",
            log_challenge_complete: "‚úî Challenge completed: \"{title}\" (+{delta} {skill})",
            log_new_skill: "‚ú® New skill added to profile: \"{skill}\"",
            reco_card_skill: "Skill",
            reco_card_duration: "Duration",
            reco_card_completed: "Completed",
            reco_card_pending: "Path generated (pending)",
            reco_card_potential_gain: "+{delta} pts (potential gain)",
            reco_card_potential_gain_short: "potential",
            reco_card_take_challenge: "Take challenge",
            progress_bar_gain_text: "{initial} ‚ûú {final} (+{gain})",
            add_context_prompt: "Enter the name for your new improvement context:",
            reco_notice_update: "‚úÖ Skill \"{skill}\" updated in your profile.",
            cert_modal_title: "Certification: {title}",
            cert_modal_subtitle: "Proposed by your agent {agent}",
            cert_modal_recognized: "Recognized by the Ministry of Labour",
            cert_modal_add_btn: "Add to my agent",
            cert_modal_syllabus_btn: "View syllabus",
            cert_modal_syllabus_btn_hide: "Hide syllabus",
            cert_modal_syllabus_title: "Certification Syllabus",
            cert_added_notice: "‚úÖ The certification path has been added to your {agent} agent.",
        }
    };

    const initialSkills = [
      { competency: { fr: "Lecture de plans", en: "Blueprint Reading" }, level: 70 },
      { competency: { fr: "Installation sanitaire", en: "Sanitary Installation" }, level: 85 },
      { competency: { fr: "Soudure cuivre", en: "Copper Welding" }, level: 65 },
      { competency: { fr: "Maintenance chaudi√®res", en: "Boiler Maintenance" }, level: 78 },
      { competency: { fr: "R√©seaux de chauffage", en: "Heating Networks" }, level: 60 },
      { competency: { fr: "Relation client", en: "Customer Relations" }, level: 55 }
    ];

    const PROVIDERS = {
      ChatGPT: {
        color: "bg-slate-900 hover:bg-slate-800",
        deltas: [{ skill: "Relation client", delta: 10, why: "retour chantier: communication et empathie" }, { skill: "R√©seaux de chauffage", delta: 5, why: "optimisation de circuits et √©quilibrage" }],
        recos: [{ title: {fr: "Efficacit√© √©nerg√©tique", en: "Energy Efficiency"}, skill: "R√©seaux de chauffage", delta: 4, duration: "2h", rationale: {fr: "param√©trage circuits radiateurs", en: "radiator circuit configuration"} }, { title: {fr: "Diagnostic chaudi√®re", en: "Boiler Diagnostics"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h30", rationale: {fr: "lecture t√©l√©m√©trie", en: "telemetry reading"} }, { title: {fr: "Situations client difficiles", en: "Difficult Customer Situations"}, skill: "Relation client", delta: 6, duration: "45min", rationale: {fr: "gestion d'objections", en: "objection handling"} }, { title: {fr: "Lecture de plans 3D", en: "3D Blueprint Reading"}, skill: "Lecture de plans", delta: 3, duration: "40min", rationale: {fr: "du 2D au terrain", en: "from 2D to the field"} }],
        insight: {fr: "Bonjour John. Votre profil montre une excellente ma√Ætrise de l'installation, un point fort. Pour atteindre votre objectif, je sugg√®re de renforcer la 'Relation client' et d'explorer les nouvelles normes en efficacit√© √©nerg√©tique. Les d√©fis propos√©s sont ax√©s sur ces deux points.", en: "Hello John. Your profile shows excellent installation mastery, a strong point. To reach your goal, I suggest strengthening 'Customer Relations' and exploring new energy efficiency standards. The proposed challenges focus on these two areas."}
      },
      Gemini: {
        color: "bg-slate-900 hover:bg-slate-800",
        deltas: [{ skill: "Soudure cuivre", delta: 7, why: "brasage avanc√©: contr√¥le capillarit√©" }, { skill: "Maintenance chaudi√®res", delta: 5, why: "pr√©ventif selon historique pannes" }],
        recos: [{ title: {fr: "Brasage cuivre avanc√©", en: "Advanced Copper Brazing"}, skill: "Soudure cuivre", delta: 7, duration: "1h", rationale: {fr: "qualit√© & s√©curit√©", en: "quality & safety"} }, { title: {fr: "Maintenance pr√©ventive", en: "Preventive Maintenance"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h", rationale: {fr: "checklist capteurs", en: "sensor checklist"} }, { title: {fr: "Checklist fin de chantier", en: "End-of-job Checklist"}, skill: "Relation client", delta: 3, duration: "20min", rationale: {fr: "satisfaction client", en: "customer satisfaction"} }, { title: {fr: "√âquilibrage de r√©seau", en: "Network Balancing"}, skill: "R√©seaux de chauffage", delta: 6, duration: "1h30", rationale: {fr: "calcul et √©quilibrage", en: "calculation and balancing"} }],
        insight: {fr: "Analyse termin√©e. Vos comp√©tences techniques en 'Soudure' et 'Maintenance' sont solides. L'objectif 'Chantier en industrie' requiert une excellence dans ces domaines. Je vous propose des d√©fis pour formaliser ces savoir-faire et atteindre un niveau expert.", en: "Analysis complete. Your technical skills in 'Welding' and 'Maintenance' are solid. The 'Industrial Site Work' objective requires excellence in these areas. I am proposing challenges to formalize this expertise and reach an expert level."}
      },
      Claude: {
        color: "bg-slate-900 hover:bg-slate-800",
        deltas: [{ skill: "Lecture de plans", delta: 6, why: "sch√©mas isom√©triques et rep√©rage" }, { skill: "Relation client", delta: 4, why: "script de communication claire" }],
        recos: [{ title: {fr: "Communication proactive", en: "Proactive Communication"}, skill: "Relation client", delta: 7, duration: "30min", rationale: {fr: "anticiper les questions", en: "anticipating questions"} }, { title: {fr: "Sch√©mas isom√©triques", en: "Isometric Schematics"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "rep√®res & cotes", en: "markers & dimensions"} }, { title: {fr: "S√©curit√© gaz", en: "Gas Safety"}, skill: "Installation sanitaire", delta: 2, duration: "25min", rationale: {fr: "bonnes pratiques", en: "best practices"} }, { title: {fr: "R√©gulation CVC", en: "HVAC Regulation"}, skill: "R√©seaux de chauffage", delta: 4, duration: "1h", rationale: {fr: "r√©gulateurs & sondes", en: "regulators & probes"} }],
        insight: {fr: "John, votre profil est √©quilibr√©. Pour un entretien, la clart√© de la communication est aussi importante que la technique. Mes recommandations visent √† renforcer votre capacit√© √† expliquer des concepts techniques ('Lecture de plans') et √† mieux interagir avec les recruteurs ('Relation client').", en: "John, your profile is well-balanced. For an interview, clear communication is as important as technical skill. My recommendations aim to enhance your ability to explain technical concepts ('Blueprint Reading') and to better interact with recruiters ('Customer Relations')."}
      },
      Mistral: {
        color: "bg-slate-900 hover:bg-slate-800",
        deltas: [{ skill: "R√©seaux de chauffage", delta: 6, why: "optimisation europ√©enne (normes)" }, { skill: "Installation sanitaire", delta: 4, why: "conformit√© DTU" }],
        recos: [{ title: {fr: "Normes europ√©ennes", en: "European Standards"}, skill: "Installation sanitaire", delta: 4, duration: "1h", rationale: {fr: "s√©curit√© & conformit√©", en: "safety & compliance"} }, { title: {fr: "√âquilibrage r√©seau terrain", en: "On-site Network Balancing"}, skill: "R√©seaux de chauffage", delta: 6, duration: "1h15", rationale: {fr: "mesures & ajustements", en: "measurements & adjustments"} }, { title: {fr: "Communication chantier", en: "Site Communication"}, skill: "Relation client", delta: 4, duration: "30min", rationale: {fr: "clart√© & trace", en: "clarity & traceability"} }, { title: {fr: "Symboles UE de plans", en: "EU Blueprint Symbols"}, skill: "Lecture de plans", delta: 3, duration: "40min", rationale: {fr: "harmonisation", en: "harmonization"} }],
        insight: {fr: "Votre expertise terrain est √©vidente. Pour vous d√©marquer, une ma√Ætrise des normes europ√©ennes (DTU) est un atout consid√©rable. Les d√©fis que je propose vous permettront de valider et de certifier ces connaissances sp√©cifiques, tr√®s recherch√©es.", en: "Your field expertise is clear. To stand out, mastering European standards (DTU) is a significant advantage. The challenges I'm offering will allow you to validate and certify this specific, highly sought-after knowledge."}
      },
      Llama: {
        color: "bg-slate-900 hover:bg-slate-800",
        deltas: [{ skill: "Relation client", delta: 5, why: "script conversationnel clair" }, { skill: "Lecture de plans", delta: 5, why: "rep√©rage symboles" }],
        recos: [{ title: {fr: "Lecture de plans pratique", en: "Practical Blueprint Reading"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "exercices guid√©s", en: "guided exercises"} }, { title: {fr: "Bases des r√©seaux intelligents", en: "Smart Grid Basics"}, skill: "Domotique CVC", delta: 8, duration: "40min", rationale: {fr: "rep√®res domotique", en: "home automation basics"} }, { title: {fr: "Maintenance avec l'IA", en: "AI-Assisted Maintenance"}, skill: "Maintenance chaudi√®res", delta: 4, duration: "45min", rationale: {fr: "aide au diagnostic", en: "diagnostic assistance"} }, { title: {fr: "Contr√¥les fin d'installation", en: "Final Installation Checks"}, skill: "Installation sanitaire", delta: 3, duration: "30min", rationale: {fr: "qualit√© per√ßue", en: "perceived quality"} }],
        insight: {fr: "Votre profil est solide. Je remarque un potentiel de d√©veloppement vers les technologies √©mergentes. J'ai donc inclus un d√©fi sur la 'Domotique CVC', une nouvelle comp√©tence qui pourrait fortement valoriser votre profil √† l'avenir.", en: "Your profile is solid. I see potential for growth into emerging technologies. I have therefore included a challenge on 'HVAC Domotics', a new skill that could greatly enhance your profile in the future."}
      }
    };
    
    let CONTEXTS = [
      { id: "recrutement", label: { fr: "Entretien d'embauche", en: "Job Interview" } },
      { id: "industrie", label: { fr: "Chantier en industrie", en: "Industrial Site Work" } },
      { id: "gestion_projet", label: { fr: "Gestion de projet CVC", en: "HVAC Project Management" } }
    ];

    const CERTIFICATIONS = [
      { id: "cert-openai-1", org: "OpenAI", emoji: "ü§ñ", title: {fr:"Diagnostic √©nerg√©tique", en:"Energy Diagnostics"}, color:"emerald", rationale: {fr:"Recommand√© pour votre ma√Ætrise de la maintenance.", en:"Recommended for your maintenance skills."}, syllabus: { fr: ["Module 1: Audit thermique", "Module 2: Analyse des donn√©es de consommation", "Module 3: Recommandations et ROI"], en: ["Module 1: Thermal Audit", "Module 2: Consumption Data Analysis", "Module 3: Recommendations & ROI"] } },
      { id: "cert-google-1", org: "Google", emoji: "üî•", title: {fr:"R√©seaux thermiques intelligents", en:"Smart Thermal Networks"}, color:"blue", rationale: {fr:"Votre expertise en r√©seaux de chauffage vous ouvre cette passerelle.", en:"Your heating network expertise opens this pathway."}, syllabus: { fr: ["Module 1: Capteurs et IoT", "Module 2: Algorithmes d'optimisation", "Module 3: Maintenance pr√©dictive"], en: ["Module 1: Sensors & IoT", "Module 2: Optimization Algorithms", "Module 3: Predictive Maintenance"] } },
      { id: "cert-anthropic-1", org: "Anthropic", emoji: "üß≠", title: {fr:"Maintenance √©thique et durable", en:"Ethical & Sustainable Maintenance"}, color:"amber", rationale: {fr:"Parfait pour valider vos comp√©tences en maintenance.", en:"Perfect for validating your maintenance skills."}, syllabus: { fr: ["Module 1: Principes de durabilit√©", "Module 2: Communication transparente", "Module 3: Fin de vie des √©quipements"], en: ["Module 1: Sustainability Principles", "Module 2: Transparent Communication", "Module 3: Equipment End-of-Life"] } },
      { id: "cert-mistral-1", org: "Mistral", emoji: "üìè", title: {fr:"Expert Normes Europ√©ennes CVC", en:"HVAC European Standards Expert"}, color:"slate", rationale: {fr:"Validez vos connaissances des DTU et normes.", en:"Validate your knowledge of DTU and standards."}, syllabus: { fr: ["Module 1: Normes EN 378 & ISO 50001", "Module 2: Application sur site", "Module 3: Veille r√©glementaire"], en: ["Module 1: EN 378 & ISO 50001 Standards", "Module 2: On-site Application", "Module 3: Regulatory Watch"] } },
      { id: "cert-meta-1", org: "Meta", emoji: "üß†", title: {fr:"Technicien CVC en environnement connect√©", en:"HVAC Technician in Connected Environments"}, color:"fuchsia", rationale: {fr:"Explorez les syst√®mes connect√©s gr√¢ce √† vos comp√©tences.", en:"Explore connected systems with your skills."}, syllabus: { fr: ["Module 1: Introduction √† la domotique", "Module 2: Protocoles (Zigbee, Matter)", "Module 3: S√©curit√© des r√©seaux domestiques"], en: ["Module 1: Introduction to Domotics", "Module 2: Protocols (Zigbee, Matter)", "Module 3: Home Network Security"] } }
    ];

    let state = { skills: [], provider: null, logs: [], recos: [], consents: { competences:true, chantiers:true, notes:false, disponibilites:false, objectifs:true }, context: CONTEXTS[0].id, pendingProvider: null, initialSkillsSnapshot: [], lastFocused: null, language: 'fr' };
    let modalKeyListener = null;
    let certModalKeyListener = null;

    // SCRIPT START
    
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // HELPERS & RENDERERS
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const $ = (s) => document.querySelector(s);
    const el = (tag, cls) => { const e=document.createElement(tag); if(cls) e.className=cls; return e; };
    
    function T(key, replacements = {}) {
        let text = translations[state.language][key] || key;
        for (const [placeholder, value] of Object.entries(replacements)) {
            text = text.replace(`{${placeholder}}`, value);
        }
        return text;
    }

    const log = (key, replacements = {}) => { 
        state.logs.push({key, replacements}); 
        renderConsole(); 
    };
    
    function getProviderLogoHtml(name) {
      const commonClasses = "h-6 w-6 object-contain";
      const logos = {
          ChatGPT: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/openai.png",
          Gemini: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1280px-Google_Gemini_logo.svg.png",
          Claude: "https://cdn.worldvectorlogo.com/logos/anthropic-1.svg", 
          Mistral: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/mistral-color.png",
          Llama: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Meta_Platforms_Inc._logo_%28cropped%29.svg/2560px-Meta_Platforms_Inc._logo_%28cropped%29.svg.png"
      };
      const url = logos[name] || '';
      return `<img src="${url}" alt="Logo for ${name}" class="${commonClasses}">`;
    }

    function orgStyles(color) {
      const map = { emerald: { chip: 'bg-emerald-100 text-emerald-800', card: 'border-emerald-200 bg-emerald-50/70' }, blue: { chip: 'bg-blue-100 text-blue-800', card: 'border-blue-200 bg-blue-50/70' }, amber: { chip: 'bg-amber-100 text-amber-800', card: 'border-amber-200 bg-amber-50/70' }, slate: { chip: 'bg-slate-100 text-slate-800', card: 'border-slate-200 bg-slate-50/70' }, fuchsia: { chip: 'bg-fuchsia-100 text-fuchsia-800', card: 'border-fuchsia-200 bg-fuchsia-50/70' } };
      return map[color] || map.slate;
    }

    const LLM_LIST = ["ChatGPT","Gemini","Claude","Mistral","Llama"];

    function renderLLMButtons(){
      const host = $("#llmButtons"); host.innerHTML = "";
      LLM_LIST.forEach(name=>{
        const btn = el("button", `w-full h-16 px-3 rounded-xl flex items-center justify-center gap-2.5 text-white font-semibold text-sm tracking-normal ${PROVIDERS[name].color} ring-1 ring-white/20 shadow-lg transition-all active:scale-[0.98] hover:shadow-xl focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500`);
        btn.setAttribute("type","button");
        btn.setAttribute("aria-label", T('analyze_with', {provider: name}));
        btn.addEventListener("click", ()=>openConsent(name));
        const iconWrap = el('span','inline-flex items-center justify-center');
        iconWrap.innerHTML = getProviderLogoHtml(name);
        const label = document.createElement('span');
        label.textContent = name;
        btn.append(iconWrap, label);
        host.appendChild(btn);
      });
    }
    
    function renderRadar(){
        const host = $("#radar"); host.innerHTML = "";
        if(!state.skills.length){
            host.innerHTML = T('radar_placeholder');
            host.className='w-full h-64 flex items-center justify-center text-sm text-slate-500';
            $("#skillsTableWrap").classList.add("hidden");
            return;
        }
        host.className = 'w-full h-64';
        const R=80, cx=100, cy=100, n=state.skills.length;
        const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
        svg.setAttribute("viewBox","0 0 200 200"); svg.setAttribute("class","w-full h-64");
        svg.setAttribute("role","img");
        svg.innerHTML = `<title>Radar des comp√©tences</title><desc>Visualisation des niveaux des comp√©tences pour John Doe</desc>`;

        [20,40,60,80].forEach(r=>{
            const c=document.createElementNS(svg.namespaceURI,"circle");
            c.setAttribute("cx",cx); c.setAttribute("cy",cy); c.setAttribute("r",r);
            c.setAttribute("fill", r===80 ? "var(--c-slate-50)" : "none");
            c.setAttribute("class","stroke-slate-200");
            svg.appendChild(c);
        });
        for(let i=0;i<n;i++){
            const a= (Math.PI*2*i)/n - Math.PI/2;
            const l=document.createElementNS(svg.namespaceURI,"line");
            l.setAttribute("x1",cx); l.setAttribute("y1",cy);
            l.setAttribute("x2",cx+R*Math.cos(a)); l.setAttribute("y2",cy+R*Math.sin(a));
            l.setAttribute("class","stroke-slate-200");
            svg.appendChild(l);
        }
        const pts = state.skills.map((s,i)=>{ const a=(Math.PI*2*i)/n - Math.PI/2; const r=(s.level/100)*R; return `${cx+r*Math.cos(a)},${cy+r*Math.sin(a)}`; }).join(" ");
        const poly = document.createElementNS(svg.namespaceURI,"polygon");
        poly.setAttribute("points", pts);
        poly.setAttribute("class","fill-indigo-400/50 stroke-indigo-600");
        poly.style.transition = "points 0.5s ease-in-out";
        svg.appendChild(poly);

        state.skills.forEach((s,i)=>{
            const a=(Math.PI*2*i)/n - Math.PI/2;
            const tx=cx+(R+12)*Math.cos(a); const ty=cy+(R+12)*Math.sin(a);
            const t=document.createElementNS(svg.namespaceURI,"text");
            t.setAttribute("x",tx); t.setAttribute("y",ty);
            t.setAttribute("text-anchor","middle"); t.setAttribute("dominant-baseline","middle");
            t.setAttribute("class","text-[10px] font-medium fill-slate-600");
            t.textContent=s.competency[state.language]; svg.appendChild(t);
        });
        host.appendChild(svg);

        const list = $("#skillsList"); list.innerHTML = "";
        state.skills.forEach(s=>{
            const li = el("li"); li.textContent = `${s.competency[state.language]} ‚Äî ${s.level}`;
            list.appendChild(li);
        });
        $("#skillsTableWrap").classList.remove("hidden");
    }

    function renderSkillBadges(){
      const host = $("#skillBadges"); host.innerHTML = "";
      if(!state.skills.length) return;
      state.skills.forEach(s=>{
        const b=el("span","inline-flex items-center rounded-full px-2.5 py-1 text-[11px] bg-indigo-100 text-indigo-800 font-medium");
        b.textContent=`${s.competency[state.language]} ‚Ä¢ ${s.level}`;
        host.appendChild(b);
      });
      const badge = $("#providerBadge");
      const objectiveWidget = $("#objectiveWidget");
      if(state.provider){
        badge.textContent = T('connected_to', {provider: state.provider});
        badge.classList.remove("hidden");
        objectiveWidget.classList.remove('hidden');
        $('#objectiveText').textContent = CONTEXTS.find(c => c.id === state.context)?.label[state.language] || '';
        $('#profileTitle').textContent= T('profile_title_user');
      } else {
        badge.classList.add("hidden");
        objectiveWidget.classList.add('hidden');
        $('#profileTitle').textContent= T('profile_title_empty');
      }
    }
    
    function renderConsole(){
        const c = $("#console");
        if (state.logs.length === 0) {
            c.innerHTML = T('console_placeholder');
            return;
        }
        c.innerHTML = state.logs.map(l => {
            let msg = T(l.key, l.replacements)
                         .replace(/‚úî/g, '<span class="console-log-gain">‚úî</span>')
                         .replace(/‚öôÔ∏è/g, '<span class="console-log-warn">‚öôÔ∏è</span>')
                         .replace(/‚ûú/g, '<span class="console-log-info">‚ûú</span>')
                         .replace(/üéØ/g, '<span class="console-log-goal">üéØ</span>');
            return `<div class="fade-in">${msg}</div>`;
        }).join("");
        c.scrollTop = c.scrollHeight;
    }
    
    function renderRecos(){
      const hint = $("#recoHint"), prov = $("#recoProvider"), grid = $("#recoGrid"), applyWrap=$("#applyAllWrap"), applyCount=$("#applyCount"), skeletons = $("#recoSkeletons");
      grid.innerHTML = "";
      if(!state.provider){
        hint.classList.remove("hidden"); prov.textContent=""; applyWrap.classList.add("hidden");
        skeletons.classList.add("hidden");
        return;
      }
      hint.classList.add("hidden"); prov.textContent = T('challenges_by', {provider: state.provider});
      
      const idleRecos = state.recos.filter(r => r.status === 'idle');
      const pendingRecos = state.recos.filter(r => r.status === 'pending');
      const completedRecos = state.recos.filter(r => r.status === 'completed');
      
      applyCount.textContent = String(idleRecos.length);
      applyWrap.classList.toggle("hidden", idleRecos.length === 0);

      const allRecos = [...idleRecos, ...pendingRecos, ...completedRecos];

      allRecos.forEach((r, idx) => {
        const cardClasses = {
            idle: "border-slate-200/80 bg-white card-3d",
            pending: "border-amber-200 bg-amber-50/50",
            completed: "border-emerald-200 bg-emerald-50/50 opacity-70"
        }[r.status];
        
        const card = el("div",`border rounded-2xl shadow-sm p-5 flex flex-col transition-all duration-300 fade-in ${cardClasses}`);
        card.style.animationDelay = `${idx * 100}ms`;
        
        let buttonHtml = '';
        if (r.status === 'idle') {
            buttonHtml = `<button class="w-full px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold transition-colors" data-reco-id="${r.id}">${T('reco_card_take_challenge')}</button>`;
        } else if (r.status === 'pending') {
            buttonHtml = `<div class="w-full text-center">
                            <p class="text-xs font-semibold text-amber-800">${T('reco_card_pending')}</p>
                            <p class="text-xs font-bold text-emerald-600/80">${T('reco_card_potential_gain', {delta: r.delta})}</p>
                          </div>`;
        } else { // completed
            buttonHtml = `<div class="w-full px-3 py-2 rounded-lg bg-emerald-600 text-white text-sm font-semibold text-center flex items-center justify-center gap-2">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                 ${T('reco_card_completed')}
               </div>`;
        }
        
        const skillName = (initialSkills.find(s => s.competency.fr === r.skill) || {competency: {}}).competency[state.language] || r.skill;

        card.innerHTML = `
          <div class="flex-1">
            <div class="flex items-start justify-between">
              <h3 class='text-base font-semibold text-slate-900'>${r.title[state.language]}</h3>
              <span class="text-sm font-bold text-emerald-600 whitespace-nowrap ml-2">+${r.delta} pts</span>
            </div>
            <div class="mt-2 text-xs space-y-1">
              <div class="flex items-center gap-2 text-slate-600"><span class="font-medium text-slate-700 w-20">${T('reco_card_skill')}:</span> ${skillName}</div>
              <div class="flex items-center gap-2 text-slate-600"><span class="font-medium text-slate-700 w-20">${T('reco_card_duration')}:</span> ${r.duration}</div>
            </div>
            <p class='mt-3 text-xs text-slate-500 italic'>${r.rationale[state.language]}</p>
          </div>
          <div class="mt-4">
            ${buttonHtml}
          </div>
        `;
        grid.appendChild(card);
      });
      
      grid.querySelectorAll('[data-reco-id]').forEach(button => {
          button.addEventListener('click', () => applyReco(button.dataset.recoId));
      });
    }

    function renderSkillProgress() {
        const host = $("#skillProgress");
        const hint = $("#gainsHint");
        host.innerHTML = "";
        
        if (!state.provider) {
            hint.classList.remove('hidden');
            return;
        }
        hint.classList.add('hidden');
        
        const skillsToRender = state.skills;

        skillsToRender.forEach((skill, idx) => {
            const initialLevel = state.initialSkillsSnapshot.find(s => s.competency.fr === skill.competency.fr)?.level || 0;
            const currentLevel = skill.level;
            
            const potentialGain = state.recos
                .filter(r => r.status === 'pending' && (r.skill === skill.competency.fr || r.skill === skill.competency.en))
                .reduce((sum, r) => sum + r.delta, 0);

            const achievedGain = currentLevel - initialLevel;
            const potentialWidth = Math.min(100 - currentLevel, potentialGain);
            
            const progressElement = el("div", "fade-in");
            progressElement.style.animationDelay = `${idx * 100}ms`;
            
            let labelText = T('progress_bar_gain_text', {initial: initialLevel, final: currentLevel, gain: achievedGain});
            if(potentialGain > 0) {
                 labelText += ` <span class="text-emerald-500">(+${potentialGain} ${T('reco_card_potential_gain_short') || 'potential'})</span>`;
            }

            progressElement.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm font-medium text-slate-700">${skill.competency[state.language]}</span>
                    <span class="text-sm font-bold text-slate-800">${T('progress_bar_gain_text', {initial: initialLevel, final: currentLevel, gain: achievedGain})}</span>
                </div>
                <div class="h-4 w-full rounded-full progress-bar-bg overflow-hidden flex">
                    <div class="progress-bar-fg h-full" style="width: ${initialLevel}%"></div>
                    <div class="progress-bar-gain h-full" style="width: ${achievedGain}%"></div>
                    <div class="progress-bar-potential h-full" style="width: ${potentialWidth}%"></div>
                </div>
            `;
            host.appendChild(progressElement);
        });
    }

    function renderAiInsight() {
        const section = $('#aiInsightSection');
        if (state.provider) {
            $('#aiInsightText').textContent = PROVIDERS[state.provider].insight[state.language] || "No summary available.";
            section.classList.remove('hidden');
            section.classList.add('fade-in');
        } else {
            section.classList.add('hidden');
        }
    }
    
    function renderCertifications() {
        const grid = $("#certGrid");
        const hint = $("#certHint");
        grid.innerHTML = "";
        if (!state.provider) {
            hint.classList.remove('hidden');
            return;
        }
        hint.classList.add('hidden');
        
        const providerOrgMap = { 'ChatGPT': 'OpenAI', 'Gemini': 'Google', 'Claude': 'Anthropic', 'Mistral': 'Mistral', 'Llama': 'Meta' };
        const org = providerOrgMap[state.provider];
        const filteredCerts = CERTIFICATIONS.filter(c => c.org === org);

        filteredCerts.forEach((c, idx) => {
            const styles = orgStyles(c.color);
            const card = el('div',`border rounded-2xl shadow-sm p-4 flex flex-col ${styles.card} card-3d transition-all duration-300 fade-in cursor-pointer`);
            card.dataset.certId = c.id;
            card.style.animationDelay = `${idx * 100}ms`;
            card.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-2xl">${c.emoji}</span>
                    <div>
                        <h4 class="font-semibold text-slate-900">${c.title[state.language]}</h4>
                        <p class="text-xs text-slate-600">Organisme : ${c.org}</p>
                    </div>
                </div>
                <p class="mt-3 text-xs text-slate-700/80 flex-1">${c.rationale[state.language]}</p>
                <div class="mt-3">
                    <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium ${styles.chip}">Passerelle disponible</span>
                </div>
            `;
            grid.appendChild(card);
        });

        grid.addEventListener('click', (e) => {
            const card = e.target.closest('[data-cert-id]');
            if (card) {
                openCertModal(card.dataset.certId);
            }
        });
    }
    
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // MODAL & CORE LOGIC
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function getFocusable(container){ return container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'); }

    function renderContextOptions() {
      const sel = $("#contextSelect");
      sel.innerHTML = "";
      CONTEXTS.forEach(c => {
        const o = document.createElement("option");
        o.value = c.id;
        o.textContent = c.label[state.language];
        sel.appendChild(o);
      });
      sel.value = state.context;
    }

    function openConsent(name){
      state.pendingProvider = name; state.lastFocused = document.activeElement;
      $("#modalProvider").textContent = name;

      const cons = $("#consents"); cons.innerHTML = "";
      const options = [{ key:"competences", label:"Comp√©tences actuelles" }, { key:"chantiers", label:"Historique de recherches" }, { key:"notes", label:"Notes personnelles" }, { key:"disponibilites", label:"Disponibilit√©s" }, { key:"objectifs", label:"Objectifs professionnels" }];
      options.forEach(opt => {
        const id = `consent_${opt.key}`;
        const row = el("div","flex items-center gap-2");
        row.innerHTML = `<input type="checkbox" id="${id}" ${state.consents[opt.key] ? 'checked' : ''} class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                         <label for="${id}" class="text-sm text-slate-800">${opt.label}</label>`;
        row.querySelector('input').addEventListener('change', e=> state.consents[opt.key] = e.target.checked);
        cons.appendChild(row);
      });
      
      renderContextOptions();
      $("#contextSelect").onchange = e => state.context = e.target.value;

      $("#addContextBtn").onclick = () => {
        const newContextLabel = prompt(T('add_context_prompt'));
        if (newContextLabel && newContextLabel.trim() !== "") {
          const newContextId = `custom_${Date.now()}`;
          CONTEXTS.push({ id: newContextId, label: {fr: newContextLabel.trim(), en: newContextLabel.trim()} });
          state.context = newContextId;
          renderContextOptions();
        }
      };

      const m = $("#modal"); m.classList.remove('hidden'); m.classList.add('flex');
      const focusables = getFocusable(m), first = focusables[0], last = focusables[focusables.length-1];
      first?.focus();
      
      modalKeyListener = (e) => {
          if(e.key === 'Tab'){
              if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
              else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
          } else if(e.key === 'Escape') closeModal();
      };
      m.addEventListener('keydown', modalKeyListener);

      m.querySelectorAll('[data-close]').forEach(b=> b.onclick = closeModal);
      $("#authorizeBtn").onclick = ()=>{ closeModal(); connectTo(state.pendingProvider); };
    }

    function closeModal(){
      const m=$("#modal");
      m.classList.add('hidden'); m.classList.remove('flex');
      if (modalKeyListener) {
        m.removeEventListener('keydown', modalKeyListener);
        modalKeyListener = null;
      }
      state.lastFocused?.focus();
    }

    function openCertModal(certId) {
        const cert = CERTIFICATIONS.find(c => c.id === certId);
        if (!cert) return;
        
        state.lastFocused = document.activeElement;
        const m = $("#certModal");
        
        $('#certModalTitle').textContent = T('cert_modal_title', { title: cert.title[state.language] });
        $('#certModalSubtitle').textContent = T('cert_modal_subtitle', { agent: state.provider });
        $('#certModalRationale').textContent = cert.rationale[state.language];

        const syllabusContainer = $('#certSyllabusContainer');
        const syllabusList = $('#certSyllabusList');
        const viewSyllabusBtn = $('#viewSyllabusBtn');
        const addCertBtn = $('#addCertToAgentBtn');
        
        syllabusContainer.classList.add('hidden');
        syllabusList.innerHTML = cert.syllabus[state.language].map(item => `<li>${item}</li>`).join('');
        viewSyllabusBtn.textContent = T('cert_modal_syllabus_btn');
        addCertBtn.textContent = T('cert_modal_add_btn');

        viewSyllabusBtn.onclick = () => {
            const isHidden = syllabusContainer.classList.toggle('hidden');
            viewSyllabusBtn.textContent = isHidden ? T('cert_modal_syllabus_btn') : T('cert_modal_syllabus_btn_hide');
        };

        addCertBtn.onclick = () => {
            const notice = $('#recoNotice');
            notice.textContent = T('cert_added_notice', {agent: state.provider});
            notice.classList.remove('hidden');
            setTimeout(() => notice.classList.add('hidden'), 5000);
            closeCertModal();
        };

        m.classList.remove('hidden'); m.classList.add('flex');
        const focusables = getFocusable(m), first = focusables[0], last = focusables[focusables.length - 1];
        first?.focus();

        certModalKeyListener = (e) => {
            if (e.key === 'Escape') closeCertModal();
            if (e.key === 'Tab') {
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); } 
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        };
        m.addEventListener('keydown', certModalKeyListener);
        m.querySelectorAll('[data-cert-close]').forEach(b => b.onclick = closeCertModal);
    }

    function closeCertModal() {
        const m = $("#certModal");
        m.classList.add('hidden'); m.classList.remove('flex');
        if (certModalKeyListener) {
            m.removeEventListener('keydown', certModalKeyListener);
            certModalKeyListener = null;
        }
        state.lastFocused?.focus();
    }
    
    async function connectTo(name){
      state.provider = name; 
      state.logs = []; 
      state.recos = [];
      state.skills = JSON.parse(JSON.stringify(initialSkills));
      state.initialSkillsSnapshot = JSON.parse(JSON.stringify(initialSkills));

      $("#recoSkeletons").classList.remove("hidden");
      $("#recoGrid").innerHTML = ''; 
      $("#certGrid").innerHTML = '';
      $('#aiInsightSection').classList.add('hidden');

      log("log_connecting");
      log("log_connection_request", {provider: name});
      await new Promise(r=>setTimeout(r,300));
      log("log_handshake_ok");
      const granted = Object.entries(state.consents).filter(([,v])=>v).map(([k])=>k).join(", ") || "(aucune)";
      log("log_consent", {granted});
      await new Promise(r=>setTimeout(r,400));
      
      const context = CONTEXTS.find(c => c.id === state.context);
      if (context) {
        log("log_objective", {context: context.label[state.language]});
      }
      await new Promise(r=>setTimeout(r,500));
      
      const conf = PROVIDERS[name];
      log("log_analysis", {count: conf.deltas.length});
      conf.deltas.forEach(d=>{
          const skillToUpdate = state.skills.find(s => s.competency.fr === d.skill);
          if(skillToUpdate) skillToUpdate.level = Math.min(100, skillToUpdate.level + d.delta);
          log("log_skill_gain", {skill: d.skill, delta: d.delta, why: d.why});
      });
      await new Promise(r=>setTimeout(r,500));
      log("log_recos_generated");
      state.recos = conf.recos.map((r,i)=> ({ id: `${name}-${i}`, status: 'idle', ...r })); // idle, pending, completed

      $("#recoSkeletons").classList.add("hidden");
      renderAll();
    }

    function applyReco(id) {
        const rec = state.recos.find(r => r.id === id);
        if (!rec || rec.status !== 'idle') return;
        
        rec.status = 'pending';
        
        const notice = $('#recoNotice');
        notice.textContent = T('reco_notice_success', {provider: state.provider});
        notice.classList.remove('hidden');
        setTimeout(() => notice.classList.add('hidden'), 5000);

        renderAll();

        // Simulate completion after a delay
        setTimeout(() => {
            completeReco(id);
        }, 4000);
    }

    function completeReco(id) {
        const rec = state.recos.find(r => r.id === id);
        if (!rec || rec.status !== 'pending') return;
        
        let skillToUpdate = state.skills.find(s => s.competency.fr === rec.skill);

        if (skillToUpdate) {
            skillToUpdate.level = Math.min(100, skillToUpdate.level + rec.delta);
        } else {
            const newSkillName = {fr: rec.skill, en: rec.skill};
            const newSkill = { competency: newSkillName, level: rec.delta };
            state.skills.push(newSkill);
            state.initialSkillsSnapshot.push({ competency: newSkillName, level: 0 });
            log("log_new_skill", {skill: rec.skill});
        }
        
        rec.status = 'completed';
        log("log_challenge_complete", {title: rec.title[state.language], delta: rec.delta, skill: rec.skill});
        renderAll();
    }
    
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // LANGUAGE & UI UPDATE
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function updateUI(lang) {
        if (!['fr', 'en'].includes(lang)) return;
        state.language = lang;
        document.documentElement.lang = lang;

        document.querySelectorAll('[data-translate-key]').forEach(el => {
            el.innerHTML = T(el.dataset.translateKey);
        });

        document.getElementById('lang-fr').classList.toggle('active', lang === 'fr');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        renderAll();
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // EVENTS & INIT
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function reset(){ 
      state.skills = [];
      state.provider = null;
      state.logs = [];
      state.recos = [];
      state.initialSkillsSnapshot = [];
      $('#recoNotice').classList.add('hidden');
      renderAll();
    }
    
    function renderAll(){
      renderRadar();
      renderSkillBadges();
      renderConsole();
      renderRecos();
      renderSkillProgress();
      renderAiInsight();
      renderCertifications();
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('applyAllBtn').addEventListener('click', ()=>{
            const btn = $('#applyAllBtn'); btn.disabled = true;
            const toApply = state.recos.filter(r => r.status === 'idle').map(r => r.id);
            toApply.forEach((id, idx)=> setTimeout(()=> applyReco(id), 200*idx));
            setTimeout(()=> { btn.disabled = false; }, 200*toApply.length + 200);
        });
        document.getElementById('lang-fr').addEventListener('click', () => updateUI('fr'));
        document.getElementById('lang-en').addEventListener('click', () => updateUI('en'));

        renderLLMButtons();
        updateUI(state.language);
    });
  </script>
</body>
</html>