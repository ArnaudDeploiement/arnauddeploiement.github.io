<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OLM : Prototype</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <style>
    :root {
      --c-bg: #000000;
      --c-surface: #f1f5f9; /* slate-100 */
      --c-surface-light: #ffffff;
      --c-on-surface: #1e293b; /* slate-800 */
      --c-on-surface-variant: #475569; /* slate-600 */
      --c-outline: #e2e8f0; /* slate-200 */
      --c-primary-accent: #ff80bf;
      --c-gradient-1: #ff80bf;
      --c-gradient-2: #9580ff;
      --c-gradient-3: #80ffea;
    }
    html { scroll-behavior: smooth; }
    body {
      background-color: var(--c-bg);
      color: #f0f2f5; /* Light text for body */
      font-family: 'Google Sans', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    .aurora-bg {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120vw;
      height: 120vh;
      z-index: -1;
      opacity: 0.3;
    }
    .aurora-bg div {
      position: absolute;
      width: 500px;
      height: 500px;
      border-radius: 50%;
      filter: blur(150px);
    }
    .aurora-1 { background: var(--c-gradient-1); top: 10%; left: 15%; animation: pulse 18s infinite alternate; }
    .aurora-2 { background: var(--c-gradient-2); bottom: 10%; right: 15%; animation: pulse 18s infinite alternate-reverse; }
    .aurora-3 { background: var(--c-gradient-3); top: 50%; left: 50%; animation: pulse-3 18s infinite alternate; }
    @keyframes pulse { from { transform: scale(0.7) rotate(0deg); } to { transform: scale(1.1) rotate(20deg); } }
    @keyframes pulse-3 { from { transform: scale(0.6) translateX(-50%); } to { transform: scale(1) translateX(50%); } }

    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24;
      vertical-align: bottom;
    }
    .fade-in { animation: fadeIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .g-card {
      background-color: var(--c-surface);
      border: 1px solid var(--c-outline);
      border-radius: 1.75rem; /* 28px */
      transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
      color: var(--c-on-surface);
    }
    .g-card:hover {
      background-color: var(--c-surface-light);
      border-color: #cbd5e1; /* slate-300 */
    }
    .g-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 500;
      font-family: 'Google Sans', sans-serif;
      padding: 0.75rem 1.5rem; /* 12px 24px */
      border-radius: 9999px;
      transition: all 0.2s ease-in-out;
      border: 1px solid transparent;
      -webkit-user-select: none; user-select: none;
    }
    .g-btn-filled {
      color: #fff;
      background-image: linear-gradient(to right, var(--c-gradient-1) 0%, var(--c-gradient-2) 50%, var(--c-gradient-3) 100%);
      background-size: 200% auto;
    }
    .g-btn-filled:hover {
      background-position: right center;
      transform: scale(1.05);
    }
    .g-btn-outlined {
      border-color: #94a3b8; /* slate-400 */
      color: #475569; /* slate-600 */
    }
    .g-btn-outlined:hover {
      background-color: rgba(0, 0, 0, 0.05);
      border-color: #475569; /* slate-600 */
    }
    .modal-backdrop { background-color: rgba(0,0,0,0.5); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    .lang-btn.active { color: white; }
    #notification { transform: translateX(200%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    #notification.show { transform: translateX(0); }
  </style>
</head>
<body class="text-base flex flex-col min-h-screen">
  <div class="aurora-bg">
    <div class="aurora-1"></div>
    <div class="aurora-2"></div>
    <div class="aurora-3"></div>
  </div>

  <!-- App Header -->
  <header class="bg-transparent sticky top-0 z-40">
    <div class="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-20">
        <a href="#" id="home-link" class="flex items-center gap-3 cursor-pointer">
          <h1 class="text-xl font-bold text-gray-200 tracking-wide">Open Learner Model</h1>
        </a>
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-1 text-sm font-medium text-gray-400 bg-black/20 backdrop-blur-md p-1 rounded-full border border-white/10">
              <button id="lang-fr" class="lang-btn px-3 py-1 rounded-full">FR</button>
              <button id="lang-en" class="lang-btn px-3 py-1 rounded-full">EN</button>
          </div>
          <div id="user-badge" class="hidden items-center gap-3">
            <div id="user-info" class="text-right">
              <p class="text-sm font-medium text-gray-200">John Doe</p>
              <p class="text-xs text-gray-400" data-translate-key="role"></p>
            </div>
            <img class="h-10 w-10 rounded-full" src="https://i.pravatar.cc/150?u=johndoe" alt="User avatar">
          </div>
        </div>
      </div>
    </div>
  </header>

  <main id="main-content" class="max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8 flex-grow">
    
    <!-- Pre-Connection State -->
    <div id="pre-connection-view">
      <div class="text-center pt-16 pb-12 sm:pt-24 sm:pb-20 px-4">
        <h2 class="text-5xl md:text-7xl font-black tracking-tighter text-white" data-translate-key="title"></h2>
        <div class="mt-6 text-lg max-w-3xl mx-auto text-gray-400" data-translate-key="subtitle"></div>
      </div>
      <div id="llmButtons" class="grid grid-cols-2 md:grid-cols-3 gap-6 max-w-6xl mx-auto"></div>
      
      <section class="max-w-5xl mx-auto mt-24 py-8">
        <div class="grid md:grid-cols-2 gap-12 items-center">
            <div class="text-gray-300">
                <div class="border-l-4 border-pink-500/50 p-4 rounded-r-lg bg-black/20">
                    <p class="font-semibold text-gray-100" data-translate-key="fiction_note_title"></p>
                    <p class="mt-2 text-sm text-gray-300/90" data-translate-key="fiction_note_p1"></p>
                </div>
                <blockquote class="mt-8 border-l-2 border-gray-600 pl-4 italic text-gray-400">
                    <p data-translate-key="fiction_quote"></p>
                    <footer class="mt-2 not-italic text-sm" data-translate-key="fiction_quote_author"></footer>
                </blockquote>
                <p class="mt-8 text-sm" data-translate-key="fiction_note_p2"></p>
            </div>
            <div class="flex items-center justify-center p-8">
                <img src="illustration.jpg" alt="Profil √©tudiant" class="rounded-3xl shadow-2xl aspect-[4/3] object-cover"/>
            </div>
        </div>
      </section>

      <div class="mt-24 max-w-6xl mx-auto">
        <h3 class="text-4xl font-bold text-center text-gray-200" data-translate-key="features_title"></h3>
        <div class="mt-12 grid md:grid-cols-3 gap-6">
            <div class="g-card p-8">
                <h3 class="text-xl font-medium flex items-center gap-3" data-translate-key="what_is_olm_title"></h3>
                <p class="mt-2 text-sm text-slate-600" data-translate-key="what_is_olm_p"></p>
                <button type="button" id="showJsonBtn" class="g-btn g-btn-outlined mt-6"><span class="material-symbols-outlined">code</span><span data-translate-key="what_is_olm_button"></span></button>
            </div>
            <div class="g-card p-8">
                <h3 class="text-xl font-medium flex items-center gap-3" data-translate-key="why_mcp_title"></h3>
                <p class="mt-2 text-sm text-slate-600" data-translate-key="why_mcp_p"></p>
            </div>
            <div class="g-card p-8">
                <h3 class="text-xl font-medium flex items-center gap-3" data-translate-key="design_fiction_title"></h3>
                <p class="mt-2 text-sm text-slate-600" data-translate-key="design_fiction_p"></p>
            </div>
        </div>
      </div>
    </div>

    <!-- Post-Connection State (Dashboard) -->
    <div id="post-connection-view" class="hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Left Column -->
        <div class="lg:col-span-1 space-y-6">
          <div class="g-card">
            <div class="p-6 border-b border-slate-200 flex items-center justify-between">
              <h3 class="text-lg font-semibold flex items-center gap-3">
                <span class="material-symbols-outlined text-pink-500">person</span><span data-translate-key="profile_title_user"></span>
              </h3>
              <div id="providerBadge" class="flex items-center gap-2 text-xs pl-2 pr-3 py-1 rounded-full bg-slate-200 text-slate-600 font-medium"></div>
            </div>
            <div class="p-6">
              <div id="radar" class="w-full aspect-square"></div>
              <div id="objectiveWidget" class="mt-6 text-center">
                  <p class="text-sm text-slate-500" data-translate-key="objective_widget_title"></p>
                  <p id="objectiveText" class="text-base font-medium text-pink-600"></p>
              </div>
            </div>
          </div>
          <div class="g-card">
            <div class="p-6 border-b border-slate-200"><h3 class="text-lg font-semibold flex items-center gap-3"><span class="material-symbols-outlined text-pink-500">hub</span><span data-translate-key="ai_insight_title"></span></h3></div>
            <div id="aiInsightText" class="p-6 text-sm text-slate-700"></div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="lg:col-span-2 space-y-6">
          <div class="g-card">
            <div class="p-6 border-b border-slate-200"><h2 class="text-lg font-semibold flex items-center gap-3"><span class="material-symbols-outlined text-pink-500">rocket_launch</span><span data-translate-key="challenges_title"></span></h2></div>
            <div id="recoGrid" class="p-6 grid md:grid-cols-2 gap-4"></div>
            <p id="recoHint" class="p-6 text-sm text-center text-slate-400" data-translate-key="challenges_placeholder"></p>
          </div>
          <div class="g-card">
            <div class="p-6 border-b border-slate-200"><h2 class="text-lg font-semibold flex items-center gap-3"><span class="material-symbols-outlined text-pink-500">trending_up</span><span data-translate-key="progress_title"></span></h2></div>
            <div id="skillProgress" class="p-6 grid md:grid-cols-2 gap-x-6 gap-y-4"></div>
             <p id="gainsHint" class="p-6 text-sm text-center text-slate-400" data-translate-key="progress_placeholder"></p>
          </div>
          <div class="g-card">
            <div class="p-6 border-b border-slate-200"><h2 class="text-lg font-semibold flex items-center gap-3"><span class="material-symbols-outlined text-pink-500">verified</span><span data-translate-key="certifications_title"></span></h2></div>
            <div id="certGrid" class="p-6 grid sm:grid-cols-2 gap-4"></div>
            <p id="certHint" class="p-6 text-sm text-center text-slate-400" data-translate-key="certifications_placeholder"></p>
          </div>
          <div class="g-card">
            <div class="p-6 border-b border-slate-200"><h3 class="text-lg font-semibold flex items-center gap-3"><span class="material-symbols-outlined text-pink-500">history</span><span data-translate-key="console_title"></span></h3></div>
            <div id="console" class="p-6 text-sm text-slate-600 space-y-3 h-64 overflow-auto font-mono"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t border-white/10 mt-24">
    <div class="max-w-screen-2xl mx-auto px-6 py-8 text-sm text-gray-400 text-center flex flex-col sm:flex-row justify-between items-center gap-4">
        <p><span data-translate-key="footer_text_1"></span> <strong class="text-gray-200" data-translate-key="footer_text_2"></strong>, <span data-translate-key="footer_text_3"></span></p>
        <a href="https://www.linkedin.com/in/arnaud-guiovanna-5aa8b5159/" target="_blank" rel="noopener noreferrer" class="g-btn g-btn-outlined !py-2 !px-4 !border-gray-600 hover:!border-gray-400 !text-gray-400 hover:!text-gray-200">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            <span data-translate-key="creator_linkedin_btn"></span>
        </a>
    </div>
  </footer>

  <!-- Modals -->
  <div id="consentModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true">
    <div class="fixed inset-0 modal-backdrop" data-consent-close></div>
    <div class="relative bg-slate-100 rounded-3xl shadow-2xl max-w-2xl w-full border border-slate-200 g-card">
        <div class="p-8">
            <h2 id="consentModalTitle" class="text-2xl font-semibold text-slate-800 flex items-center gap-3"></h2>
            <p class="mt-2 text-slate-500" data-translate-key="modal_subtitle"></p>

            <div class="mt-8 grid md:grid-cols-2 gap-6">
                <fieldset class="border border-slate-200 rounded-2xl p-4">
                    <legend class="px-2 text-sm font-medium text-slate-600" data-translate-key="modal_data_title"></legend>
                    <div id="consents" class="mt-4 space-y-4"></div>
                </fieldset>

                <fieldset class="border border-slate-200 rounded-2xl p-4 flex flex-col">
                    <legend class="px-2 text-sm font-medium text-slate-600" data-translate-key="modal_objective_title"></legend>
                    <div class="flex-1">
                        <label for="contextSelect" class="sr-only" data-translate-key="modal_objective_select_sr"></label>
                        <select id="contextSelect" class="mt-2 w-full bg-white border border-slate-300 rounded-lg px-3 py-2.5 text-base text-slate-800 focus:border-pink-500 focus:ring-pink-500"></select>
                        <p class="mt-2 text-xs text-slate-500" data-translate-key="modal_objective_p"></p>
                    </div>
                    <button id="addContextBtn" type="button" class="g-btn g-btn-text text-sm self-start -ml-4 mt-2 !text-pink-600 hover:!bg-pink-500/10" data-translate-key="modal_add_context_btn"></button>
                </fieldset>
            </div>

            <div class="mt-8 flex items-center justify-end gap-3">
                <button type="button" class="g-btn g-btn-outlined" data-consent-close data-translate-key="modal_cancel_btn"></button>
                <button id="authorizeBtn" class="g-btn g-btn-filled" data-translate-key="modal_authorize_btn"></button>
            </div>
        </div>
    </div>
  </div>

  <div id="jsonModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true">
      <div class="fixed inset-0 modal-backdrop" data-json-close></div>
      <div class="relative bg-slate-900/90 backdrop-blur-xl rounded-2xl shadow-2xl max-w-4xl w-full border border-white/20">
          <div class="p-6 flex justify-between items-center">
              <h2 class="text-lg font-medium text-slate-200 flex items-center gap-3"><span class="material-symbols-outlined">data_object</span><span data-translate-key="json_modal_title"></span></h2>
              <button type="button" class="p-1 rounded-full text-slate-400 hover:text-white" data-json-close aria-label="Close">
                  <span class="material-symbols-outlined">close</span>
              </button>
          </div>
          <div class="p-4 h-[60vh] overflow-auto font-mono text-xs text-sky-300 bg-black/30 rounded-xl border border-white/10">
              <pre><code id="jsonContent"></code></pre>
          </div>
      </div>
  </div>
  
  <div id="certModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true">
        <div class="fixed inset-0 modal-backdrop" data-cert-close></div>
        <div class="relative bg-slate-100 rounded-3xl shadow-2xl max-w-lg w-full border border-slate-200 g-card">
            <div class="p-8">
                <h2 id="certModalTitle" class="text-2xl font-semibold text-slate-800"></h2>
                <p id="certModalSubtitle" class="mt-1 text-slate-500"></p>
                <p id="certModalRationale" class="mt-6 text-slate-700"></p>
                <div id="certSyllabusContainer" class="mt-6 hidden border-t border-slate-200 pt-6">
                    <h4 class="font-semibold text-slate-700 text-sm" data-translate-key="cert_modal_syllabus_title"></h4>
                    <ul id="certSyllabusList" class="mt-4 text-slate-600 list-disc list-inside space-y-2"></ul>
                </div>
                <div class="mt-8 flex flex-col sm:flex-row-reverse gap-4">
                    <button id="addCertToAgentBtn" class="g-btn g-btn-filled w-full"></button>
                    <button id="viewSyllabusBtn" class="g-btn g-btn-outlined w-full"></button>
                </div>
            </div>
        </div>
    </div>

  <div id="notification" class="fixed top-6 right-6 z-50 max-w-sm w-full rounded-2xl border bg-slate-100 p-5 shadow-2xl text-sm flex items-center gap-4 g-card">
    <span id="notification-icon" class="material-symbols-outlined"></span>
    <p id="notification-text" class="text-slate-800"></p>
  </div>

  <script>
    // --- I18N & DATA ------------------------------------------------------
    const translations = {
        fr: {
            role: "Plombier",
            title: "Connectez votre OLM √† un agent IA.",
            subtitle: "Votre Open Learner Model (OLM) est un profil de comp√©tences qui vous appartient. Connectez-le √† un agent IA pour obtenir une analyse et un parcours de progression sur-mesure.",
            fiction_note_title: "// Note : ceci est un design fiction",
            fiction_note_p1: "Vous incarnez ici John Doe, un apprenant fictif. Ce prototype explore le futur de l'apprentissage personnalis√© et portable, sans utiliser aucune donn√©e r√©elle.",
            fiction_quote: "'ChatGPT est aujourd'hui la plus grande plateforme d'apprentissage au monde. L'apprentissage est l'un des principaux usages de la plateforme avec 600 millions d'utilisateurs.'",
            fiction_quote_author: "‚Äî Leah Belsky, VP Education chez OpenAI",
            fiction_note_p2: "Si les IA deviennent les nouvelles plateformes d'apprentissage, comment garantir une exp√©rience centr√©e sur l'apprenant ? L'Open Learner Model (OLM) est une piste : un standard pour un jumeau num√©rique de vos comp√©tences, portable et interop√©rable, que vous contr√¥lez.",
            features_title: "Un profil unique, des possibilit√©s infinies",
            connect_agent_title: "Choisissez votre Agent IA",
            connect_agent_subtitle: "S√©lectionnez un agent pour analyser votre profil et construire votre plan de progression.",
            profile_title_user: "Profil OLM de John Doe",
            connected_to: "Connect√© √†",
            objective_widget_title: "Objectif Actuel",
            radar_placeholder: "Connectez un agent pour visualiser le profil.",
            console_title: "Journal d'Activit√©",
            ai_insight_title: "Synth√®se de l'Agent",
            challenges_title: "Vos Prochains D√©fis",
            challenges_placeholder: "Connectez un agent pour d√©couvrir vos d√©fis personnalis√©s.",
            progress_title: "Suivi de Progression",
            progress_placeholder: "L'√©volution de vos comp√©tences appara√Ætra ici.",
            certifications_title: "Certifications g√©n√©r√©es par l'IA",
            certifications_placeholder: "Connectez un agent pour identifier des certifications.",
            what_is_olm_title: "üß† Qu‚Äôest-ce qu‚Äôun OLM ?",
            what_is_olm_p: "L'<strong>Open Learner Model</strong> est votre profil de comp√©tences dynamique et portable. Il vous appartient, vous le contr√¥lez, et il fonctionne partout.",
            why_mcp_title: "üîó Le standard MCP",
            why_mcp_p: "Le <strong>Model Context Protocol (MCP)</strong> est un protocole universel qui permet √† votre OLM de communiquer de fa√ßon s√©curis√©e et standardis√©e avec n'importe quelle IA.",
            design_fiction_title: "üí° Un Vision du Futur",
            design_fiction_p: "Ce prototype illustre un futur o√π chaque apprenant poss√®de et contr√¥le ses donn√©es, ouvrant la voie √† une reconnaissance universelle des comp√©tences.",
            what_is_olm_button: "Voir un exemple",
            json_modal_title: "Donn√©es brutes OLM",
            modal_title: "Autoriser la connexion",
            modal_subtitle: "Partagez les donn√©es de votre OLM et d√©finissez un objectif pour l'analyse.",
            modal_data_title: "Donn√©es √† partager",
            modal_objective_title: "Objectif",
            modal_objective_select_sr: "S√©lectionnez un objectif",
            modal_objective_p: "L'agent adaptera ses recommandations √† cet objectif.",
            modal_add_context_btn: "+ Ajouter un objectif",
            modal_cancel_btn: "Annuler",
            modal_authorize_btn: "Autoriser & Lancer",
            add_context_prompt: "Entrez le nom de votre nouvel objectif :",
            log_connecting: "Connexion s√©curis√©e √† l'agent <strong>{provider}</strong>...",
            log_analysis: "Analyse du profil OLM en cours...",
            log_skill_gain: "Comp√©tence am√©lior√©e : <strong>{skill} (+{delta})</strong> via {why}.",
            log_recos_generated: "Parcours de progression g√©n√©r√©.",
            log_challenge_complete: "D√©fi relev√© : <strong>{title}</strong> (+{delta} pts)",
            reco_card_completed: "Termin√©",
            reco_card_take_challenge: "Relever le d√©fi",
            reco_card_pending: "En cours...",
            cert_modal_title: "Certification : {title}",
            cert_modal_subtitle: "Propos√©e par votre agent {agent}",
            cert_modal_add_btn: "Ajouter √† l'agent IA",
            cert_modal_syllabus_btn: "Voir le programme",
            cert_modal_syllabus_btn_hide: "Masquer le programme",
            cert_modal_syllabus_title: "Programme de la certification",
            cert_added_notice: "Le parcours de certification a √©t√© ajout√© √† votre agent.",
            cert_card_added: "Ajout√©",
            footer_text_1: "Un prototype imagin√© par",
            footer_text_2: "Arnaud Guiovanna",
            footer_text_3: "Product Manager IA & Learning",
            creator_linkedin_btn: "Profil LinkedIn"
        },
        en: {
            role: "Plumber",
            title: "Connect your OLM to an AI agent.",
            subtitle: "Your Open Learner Model (OLM) is a skills profile that you own. Connect it to an AI agent to get a custom analysis and progression path.",
            fiction_note_title: "// Note: this is a design fiction",
            fiction_note_p1: "You are playing as John Doe, a fictional learner. This prototype explores the future of personalized, portable learning, without using any real data.",
            fiction_quote: "'ChatGPT is now the world\'s largest learning platform. Learning is one of the top use cases on the platform at 600 million users.'",
            fiction_quote_author: "‚Äî Leah Belsky, VP Education at OpenAI",
            fiction_note_p2: "If AIs become the new learning platforms, how do we ensure a learner-centric experience? The Open Learner Model (OLM) is one possible answer: a standard for a portable, interoperable digital twin of your skills, that you control.",
            features_title: "One unique profile, endless possibilities",
            connect_agent_title: "Choose your AI Agent",
            connect_agent_subtitle: "Select an agent to analyze your profile and build your progression plan.",
            profile_title_user: "John Doe\'s OLM Profile",
            connected_to: "Connected to",
            objective_widget_title: "Current Objective",
            radar_placeholder: "Connect an agent to visualize the profile.",
            console_title: "Activity Log",
            ai_insight_title: "Agent\'s Summary",
            challenges_title: "Your Next Challenges",
            challenges_placeholder: "Connect an agent to discover your personalized challenges.",
            progress_title: "Progress Tracking",
            progress_placeholder: "Your skill development will appear here.",
            certifications_title: "AI-Generated Certifications",
            certifications_placeholder: "Connect an agent to identify certifications.",
            what_is_olm_title: "üß† What is an OLM?",
            what_is_olm_p: "The <strong>Open Learner Model</strong> is your dynamic and portable skills profile. You own it, you control it, and it works everywhere.",
            why_mcp_title: "üîó The MCP Standard",
            why_mcp_p: "The <strong>Model Context Protocol (MCP)</strong> is the universal protocol that allows your OLM to communicate securely and standardly with any AI.",
            design_fiction_title: "üí° A Vision of the Future",
            design_fiction_p: "This demo illustrates a future where every learner owns and controls their learning data, paving the way for universal skill recognition.",
            what_is_olm_button: "See an example",
            json_modal_title: "Raw OLM Data",
            modal_title: "Authorize Connection",
            modal_subtitle: "Share your OLM data and set an objective for the analysis.",
            modal_data_title: "Data to Share",
            modal_objective_title: "Objective",
            modal_objective_select_sr: "Select an objective",
            modal_objective_p: "The agent will tailor its recommendations to this objective.",
            modal_add_context_btn: "+ Add objective",
            modal_cancel_btn: "Cancel",
            modal_authorize_btn: "Authorize & Launch",
            add_context_prompt: "Enter the name for your new objective:",
            log_connecting: "Securely connecting to <strong>{provider}</strong> agent...",
            log_analysis: "Analyzing OLM profile...",
            log_skill_gain: "Skill improved: <strong>{skill} (+{delta})</strong> via {why}.",
            log_recos_generated: "Progression path generated.",
            log_challenge_complete: "Challenge completed: <strong>{title}</strong> (+{delta} pts)",
            reco_card_completed: "Completed",
            reco_card_take_challenge: "Take challenge",
            reco_card_pending: "In progress...",
            cert_modal_title: "Certification: {title}",
            cert_modal_subtitle: "Proposed by your {agent} agent",
            cert_modal_add_btn: "Add to AI agent",
            cert_modal_syllabus_btn: "View syllabus",
            cert_modal_syllabus_btn_hide: "Hide syllabus",
            cert_modal_syllabus_title: "Certification Syllabus",
            cert_added_notice: "The certification path has been added to your agent.",
            cert_card_added: "Added",
            footer_text_1: "A prototype designed by",
            footer_text_2: "Arnaud Guiovanna",
            footer_text_3: "AI & Learning Product Manager",
            creator_linkedin_btn: "LinkedIn Profile"
        }
    };

    const initialSkills = [
      { competency: { fr: "Lecture de plans", en: "Blueprint Reading" }, level: 70 },
      { competency: { fr: "Installation sanitaire", en: "Sanitary Installation" }, level: 85 },
      { competency: { fr: "Soudure cuivre", en: "Copper Welding" }, level: 65 },
      { competency: { fr: "Maintenance chaudi√®res", en: "Boiler Maintenance" }, level: 78 },
      { competency: { fr: "R√©seaux de chauffage", en: "Heating Networks" }, level: 60 },
      { competency: { fr: "Relation client", en: "Customer Relations" }, level: 55 }
    ];

    let CONTEXTS = [
      { id: "recrutement", label: { fr: "Pr√©parer un entretien", en: "Prepare for an interview" } },
      { id: "industrie", label: { fr: "Intervenir en industrie", en: "Work on an industrial site" } },
      { id: "gestion_projet", label: { fr: "G√©rer un projet CVC", en: "Manage an HVAC project" } }
    ];

    const PROVIDERS = {
      ChatGPT: { deltas: [{ skill: "Relation client", delta: 10, why: "retour chantier: communication et empathie" }, { skill: "R√©seaux de chauffage", delta: 5, why: "optimisation de circuits et √©quilibrage" }], recos: [{ title: {fr: "Efficacit√© √©nerg√©tique", en: "Energy Efficiency"}, skill: "R√©seaux de chauffage", delta: 4, duration: "2h", rationale: {fr: "param√©trage circuits radiateurs", en: "radiator circuit configuration"} }, { title: {fr: "Diagnostic chaudi√®re", en: "Boiler Diagnostics"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h30", rationale: {fr: "lecture t√©l√©m√©trie", en: "telemetry reading"} }, { title: {fr: "Situations client difficiles", en: "Difficult Customer Situations"}, skill: "Relation client", delta: 6, duration: "45min", rationale: {fr: "gestion d'objections", en: "objection handling"} }], insight: {fr: "Bonjour John. Votre profil montre une excellente ma√Ætrise de l'installation. Pour atteindre votre objectif, je sugg√®re de renforcer la 'Relation client' et d'explorer les nouvelles normes en efficacit√© √©nerg√©tique.", en: "Hello John. Your profile shows excellent installation mastery. To reach your goal, I suggest strengthening 'Customer Relations' and exploring new energy efficiency standards."} },
      Gemini: { deltas: [{ skill: "Soudure cuivre", delta: 7, why: "brasage avanc√©: contr√¥le capillarit√©" }, { skill: "Maintenance chaudi√®res", delta: 5, why: "pr√©ventif selon historique pannes" }], recos: [{ title: {fr: "Brasage cuivre avanc√©", en: "Advanced Copper Brazing"}, skill: "Soudure cuivre", delta: 7, duration: "1h", rationale: {fr: "qualit√© & s√©curit√©", en: "quality & safety"} }, { title: {fr: "Maintenance pr√©ventive", en: "Preventive Maintenance"}, skill: "Maintenance chaudi√®res", delta: 5, duration: "1h", rationale: {fr: "checklist capteurs", en: "sensor checklist"} }, { title: {fr: "Checklist fin de chantier", en: "End-of-job Checklist"}, skill: "Relation client", delta: 3, duration: "20min", rationale: {fr: "satisfaction client", en: "customer satisfaction"} }], insight: {fr: "Analyse termin√©e. Vos comp√©tences techniques en 'Soudure' et 'Maintenance' sont solides. L'objectif 'Chantier en industrie' requiert une excellence dans ces domaines. Je vous propose des d√©fis pour formaliser ces savoir-faire.", en: "Analysis complete. Your technical skills in 'Welding' and 'Maintenance' are solid. The 'Industrial Site Work' objective requires excellence in these areas. I am proposing challenges to formalize this expertise."} },
      Claude: { deltas: [{ skill: "Lecture de plans", delta: 6, why: "sch√©mas isom√©triques et rep√©rage" }, { skill: "Relation client", delta: 4, why: "script de communication claire" }], recos: [{ title: {fr: "Communication proactive", en: "Proactive Communication"}, skill: "Relation client", delta: 7, duration: "30min", rationale: {fr: "anticiper les questions", en: "anticipating questions"} }, { title: {fr: "Sch√©mas isom√©triques", en: "Isometric Schematics"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "rep√®res & cotes", en: "markers & dimensions"} }, { title: {fr: "S√©curit√© gaz", en: "Gas Safety"}, skill: "Installation sanitaire", delta: 2, duration: "25min", rationale: {fr: "bonnes pratiques", en: "best practices"} }], insight: {fr: "John, votre profil est √©quilibr√©. Pour un entretien, la clart√© de la communication est aussi importante que la technique. Mes recommandations visent √† renforcer votre capacit√© √† expliquer des concepts techniques et √† mieux interagir.", en: "John, your profile is well-balanced. For an interview, clear communication is as important as technical skill. My recommendations aim to enhance your ability to explain technical concepts and to better interact with recruiters."} },
      Mistral: { deltas: [{ skill: "R√©seaux de chauffage", delta: 6, why: "optimisation europ√©enne (normes)" }, { skill: "Installation sanitaire", delta: 4, why: "conformit√© DTU" }], recos: [{ title: {fr: "Normes europ√©ennes", en: "European Standards"}, skill: "Installation sanitaire", delta: 4, duration: "1h", rationale: {fr: "s√©curit√© & conformit√©", en: "safety & compliance"} }, { title: {fr: "√âquilibrage r√©seau terrain", en: "On-site Network Balancing"}, skill: "R√©seaux de chauffage", delta: 6, duration: "1h15", rationale: {fr: "mesures & ajustements", en: "measurements & adjustments"} }, { title: {fr: "Communication chantier", en: "Site Communication"}, skill: "Relation client", delta: 4, duration: "30min", rationale: {fr: "clart√© & trace", en: "clarity & traceability"} }], insight: {fr: "Votre expertise terrain est √©vidente. Pour vous d√©marquer, une ma√Ætrise des normes europ√©ennes (DTU) est un atout consid√©rable. Les d√©fis que je propose vous permettront de valider ces connaissances sp√©cifiques.", en: "Your field expertise is clear. To stand out, mastering European standards (DTU) is a significant advantage. The challenges I'm offering will allow you to validate this specific knowledge."} },
      Llama: { deltas: [{ skill: "Relation client", delta: 5, why: "script conversationnel clair" }, { skill: "Lecture de plans", delta: 5, why: "rep√©rage symboles" }], recos: [{ title: {fr: "Lecture de plans pratique", en: "Practical Blueprint Reading"}, skill: "Lecture de plans", delta: 5, duration: "45min", rationale: {fr: "exercices guid√©s", en: "guided exercises"} }, { title: {fr: "Bases des r√©seaux intelligents", en: "Smart Grid Basics"}, skill: "Domotique CVC", delta: 8, duration: "40min", rationale: {fr: "rep√®res domotique", en: "home automation basics"} }, { title: {fr: "Maintenance avec l'IA", en: "AI-Assisted Maintenance"}, skill: "Maintenance chaudi√®res", delta: 4, duration: "45min", rationale: {fr: "aide au diagnostic", en: "diagnostic assistance"} }], insight: {fr: "Votre profil est solide. Je remarque un potentiel de d√©veloppement vers les technologies √©mergentes. J'ai donc inclus un d√©fi sur la 'Domotique CVC', une nouvelle comp√©tence qui pourrait fortement valoriser votre profil.", en: "Your profile is solid. I see potential for growth into emerging technologies. I have therefore included a challenge on 'HVAC Domotics', a new skill that could greatly enhance your profile."} },
      Ollama: { deltas: [{ skill: "Relation client", delta: 4, why: "documentation technique claire" }, { skill: "Soudure cuivre", delta: 4, why: "exp√©rimentation locale" }], recos: [{ title: {fr: "Tester un mod√®le 7B pour la synth√®se", en: "Test a 7B model for synthesis"}, skill: "Relation client", delta: 3, duration: "2h", rationale: {fr: "g√©n√©ration de rapports de chantier", en: "job report generation"} }, { title: {fr: "Fine-tuner un mod√®le sur vos notes", en: "Fine-tune a model on your notes"}, skill: "Maintenance chaudi√®res", delta: 8, duration: "10h", rationale: {fr: "cr√©er un assistant de diagnostic personnel", en: "create a personal diagnostic assistant"} }], insight: {fr: "En tant qu'agent local, Ollama garantit la confidentialit√© totale de vos donn√©es. Les d√©fis propos√©s sont ax√©s sur l'exp√©rimentation avec des mod√®les open-source pour une personnalisation maximale de votre parcours.", en: "As a local agent, Ollama guarantees complete confidentiality of your data. The proposed challenges are focused on experimenting with open-source models for maximum personalization of your journey."} }
    }
    
    const CERTIFICATIONS = [
      { id: "cert-openai-1", org: "ChatGPT", emoji: "ü§ñ", title: {fr:"Diagnostic √©nerg√©tique assist√© par IA", en:"AI-Assisted Energy Diagnostics"}, rationale: {fr:"Recommand√© pour votre ma√Ætrise de la maintenance et votre int√©r√™t pour les nouvelles technologies.", en:"Recommended for your maintenance skills and interest in new technologies."}, syllabus: { fr: ["Module 1: Audit thermique", "Module 2: Analyse des donn√©es", "Module 3: Recommandations"], en: ["Module 1: Thermal Audit", "Module 2: Data Analysis", "Module 3: Recommendations"] } },
      { id: "cert-google-1", org: "Gemini", emoji: "‚ú®", title: {fr:"R√©seaux thermiques intelligents", en:"Smart Thermal Networks"}, rationale: {fr:"Votre expertise en r√©seaux de chauffage est le pr√©requis id√©al pour cette certification avanc√©e.", en:"Your heating network expertise is the ideal prerequisite for this advanced certification."}, syllabus: { fr: ["Module 1: Capteurs et IoT", "Module 2: Optimisation", "Module 3: Maintenance pr√©dictive"], en: ["Module 1: Sensors & IoT", "Module 2: Optimization", "Module 3: Predictive Maintenance"] } },
    ];

    const olmExampleJson = {
      "id": "olm-john-doe-12345", "owner": "John Doe", "version": "1.0.0", "last_updated": "2025-09-30T10:00:00Z",
      "profile": { "role": "Plombier / Chauffagiste", "status": "En recherche active, ouvert √† la formation" },
      "skills": {
        "hard_skills": [
          { "name": "Lecture de plans", "level": 70 }, { "name": "Installation sanitaire", "level": 85 },
          { "name": "Soudure cuivre", "level": 65 }, { "name": "Maintenance chaudi√®res", "level": 78 },
          { "name": "R√©seaux de chauffage", "level": 60 },
        ],
        "soft_skills": [ { "name": "Relation client", "level": 55 } ]
      },
    };

    let state = { skills: [], provider: null, recos: [], logs: [], initialSkillsSnapshot: [], language: 'fr', pendingProvider: null, consents: { competences:true, historique:true, objectifs: true, notes:false, disponibilites: false }, context: CONTEXTS[0].id, certificationStatus: {} };

    // --- UTILS & HELPERS ----------------------------------------------------
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);
    const el = (tag, cls) => { const e=document.createElement(tag); if(cls) e.className=cls; return e; };

    function T(key, replacements = {}) {
        let text = translations[state.language][key] || key;
        for (const [placeholder, value] of Object.entries(replacements)) {
            text = text.replace(`{${placeholder}}`, value);
        }
        return text;
    }

    let notificationTimeout;
    function showNotification(text, type = 'success') {
      const notification = $('#notification');
      const icon = $('#notification-icon');
      const textEl = $('#notification-text');

      clearTimeout(notificationTimeout);

      const icons = { success: 'check_circle', warning: 'warning', error: 'error', info: 'info' };
      const colors = { success: '#00f5d4', warning: '#fde047', error: '#f28b82', info: '#9580ff' };
      const color = colors[type] || '#a0a3a7';

      icon.style.color = color;
      textEl.textContent = text;
      notification.style.borderColor = `${color}80`;
      
      notification.classList.add('show');
      notificationTimeout = setTimeout(() => notification.classList.remove('show'), 6000);
    }

    // --- RENDER FUNCTIONS --------------------------------------------------
    function updateUI() {
        document.documentElement.lang = state.language;
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            el.innerHTML = T(el.dataset.translateKey);
        });
        $('#lang-fr').classList.toggle('active', state.language === 'fr');
        $('#lang-en').classList.toggle('active', state.language === 'en');
        renderAll();
    }

    function renderLLMButtons() {
        const host = $("#llmButtons");
        host.innerHTML = "";

        const providerInfo = {
            ChatGPT: { logo: 'https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/light/openai.png' },
            Gemini: { logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1280px-Google_Gemini_logo.svg.png' },
            Claude: { logo: 'https://cdn.worldvectorlogo.com/logos/anthropic-1.svg' },
            Mistral: { logo: 'https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/mistral-color.png' },
            Llama: { logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Meta_Platforms_Inc._logo_%28cropped%29.svg/2560px-Meta_Platforms_Inc._logo_%28cropped%29.svg.png' },
            Ollama: { logo: 'https://ollama.com/public/ollama.png' }
        };

        Object.keys(providerInfo).forEach(name => {
            const info = providerInfo[name];
            const card = el("div", "g-card p-6 flex flex-col items-center justify-center text-center");

            const logoHtml = `<img src="${info.logo}" alt="Logo ${name}" class="h-8 object-contain">`;

            card.innerHTML = `
              <div class="h-12 flex items-center justify-center">${logoHtml}</div>
              <h3 class="mt-4 text-lg font-medium text-slate-800">${name}</h3>
            `;
            
            const button = el('button', 'g-btn g-btn-filled mt-6 w-full');
            button.innerHTML = `<span class="material-symbols-outlined text-lg">hub</span> Connecter`;
            button.addEventListener('click', () => openConsentModal(name));
            
            card.appendChild(button);
            host.appendChild(card);
        });
    }

    function renderRadar() {
        const host = document.getElementById('radar');
        if (!host) return;
        host.innerHTML = '';
        if (!state.skills || state.skills.length === 0) {
            host.innerHTML = `<div class="flex items-center justify-center h-full text-slate-400">${T('radar_placeholder')}</div>`;
            return;
        };

        const width = host.clientWidth;
        const height = host.clientHeight;
        const cx = width / 2;
        const cy = height / 2;
        const radius = Math.min(width, height) / 2 * 0.7;
        const numSkills = state.skills.length;

        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
        
        [25, 50, 75, 100].forEach(val => {
            const r = (val / 100) * radius;
            const circle = document.createElementNS(svg.namespaceURI, 'circle');
            circle.setAttribute('cx', cx); circle.setAttribute('cy', cy); circle.setAttribute('r', r);
            circle.setAttribute('fill', 'none'); circle.setAttribute('class', 'stroke-slate-300');
            svg.appendChild(circle);
        });

        for (let i = 0; i < numSkills; i++) {
            const angle = (Math.PI * 2 * i) / numSkills - Math.PI / 2;
            const line = document.createElementNS(svg.namespaceURI, 'line');
            line.setAttribute('x1', cx); line.setAttribute('y1', cy);
            line.setAttribute('x2', cx + radius * Math.cos(angle)); line.setAttribute('y2', cy + radius * Math.sin(angle));
            line.setAttribute('class', 'stroke-slate-300');
            svg.appendChild(line);
        }

        const pts = state.skills.map((s, i) => {
            const angle = (Math.PI * 2 * i) / numSkills - Math.PI / 2;
            const r = (s.level / 100) * radius;
            return `${cx + r * Math.cos(angle)},${cy + r * Math.sin(angle)}`;
        }).join(' ');

        const polygon = document.createElementNS(svg.namespaceURI, 'polygon');
        polygon.setAttribute('points', pts);
        polygon.setAttribute('class', 'fill-pink-500/20 stroke-pink-500 stroke-2');
        polygon.style.transition = "points 0.4s ease-in-out";
        svg.appendChild(polygon);

        state.skills.forEach((s, i) => {
            const angle = (Math.PI * 2 * i) / numSkills - Math.PI / 2;
            const labelRadius = radius * 1.25;
            const x = cx + labelRadius * Math.cos(angle);
            const y = cy + labelRadius * Math.sin(angle);
            
            const text = document.createElementNS(svg.namespaceURI, 'text');
            text.setAttribute('x', x); text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle'); text.setAttribute('dominant-baseline', 'middle');
            text.setAttribute('class', 'text-[11px] sm:text-[13px] font-medium fill-slate-600');
            text.textContent = s.competency[state.language];
            svg.appendChild(text);
        });

        host.appendChild(svg);
    }

    function renderRecos() {
      const grid = $("#recoGrid"), hint = $("#recoHint");
      grid.innerHTML = "";
      if(!state.provider) { hint.classList.remove("hidden"); return; }
      hint.classList.add("hidden");
      
      state.recos.forEach(r => {
        const card = el("div", `g-card p-6 flex flex-col transition-opacity`);
        const skillName = (initialSkills.find(s => s.competency.fr === r.skill) || {competency: {fr: r.skill, en: r.skill}}).competency?.[state.language] || r.skill;
        
        let buttonHtml;
        if (r.status === 'completed') {
            card.classList.add('opacity-60');
            buttonHtml = `<div class="g-btn bg-green-600/20 text-green-800 w-full text-sm cursor-default">${T('reco_card_completed')}</div>`;
        } else if (r.status === 'pending') {
            buttonHtml = `<div class="g-btn bg-amber-500/20 text-amber-800 w-full text-sm cursor-default">${T('reco_card_pending')}</div>`;
        } else {
            buttonHtml = `<button data-reco-id="${r.id}" class="g-btn g-btn-filled w-full text-sm">${T('reco_card_take_challenge')}</button>`;
        }

        card.innerHTML = `
          <div class="flex-1">
            <h4 class="font-medium text-slate-800">${r.title[state.language]}</h4>
            <p class="mt-2 text-xs text-slate-500">${r.rationale[state.language]}</p>
          </div>
          <div class="mt-4 pt-4 border-t border-slate-200 flex items-center justify-between text-xs text-slate-500">
            <span><span class="font-medium text-green-600">+${r.delta} pts</span> ${skillName}</span>
            <span><span class="material-symbols-outlined text-sm">timer</span> ${r.duration}</span>
          </div>
          <div class="mt-6">${buttonHtml}</div>
        `;
        grid.appendChild(card);
      });

      grid.querySelectorAll('[data-reco-id]').forEach(button => {
          button.addEventListener('click', () => applyReco(button.dataset.recoId));
      });
    }

    function renderSkillProgress() {
        const host = $("#skillProgress"), hint = $("#gainsHint");
        host.innerHTML = "";
        if (!state.provider) { hint.classList.remove('hidden'); return; }
        hint.classList.add('hidden');
        
        state.skills.forEach(skill => {
            const initialLevel = (state.initialSkillsSnapshot.find(s => s.competency.fr === skill.competency.fr) || {}).level || 0;
            const achievedGain = skill.level - initialLevel;
            host.innerHTML += `
                <div>
                    <div class="flex justify-between items-center mb-1.5">
                        <span class="text-sm font-medium text-slate-700">${skill.competency[state.language]}</span>
                        <span class="text-sm font-medium text-slate-800">${initialLevel} ‚ûú ${skill.level}</span>
                    </div>
                    <div class="h-2 w-full rounded-full bg-slate-200 overflow-hidden flex">
                        <div class="bg-slate-400 h-full" style="width: ${initialLevel}%; transition: width 0.4s ease-in-out;"></div>
                        <div class="bg-green-500 h-full" style="width: ${achievedGain}%; transition: width 0.4s ease-in-out;"></div>
                    </div>
                </div>
            `;
        });
    }

    function renderCerts() {
      const grid = $("#certGrid"), hint = $("#certHint");
      grid.innerHTML = "";
      if(!state.provider) { hint.classList.remove("hidden"); return; }
      hint.classList.add("hidden");
      
      CERTIFICATIONS.filter(c => c.org === state.provider).forEach(c => {
        const isAdded = state.certificationStatus[c.id] === 'added';
        const card = el('div', 'g-card p-6 flex flex-col');
        card.dataset.certId = c.id;
        
        let footerHtml;
        if (isAdded) {
            card.classList.add('!border-green-500/50', 'bg-green-500/10');
            footerHtml = `<div class="flex items-center gap-2 text-green-700 font-medium text-sm">
                          <span class="material-symbols-outlined">check_circle</span>
                          <span>${T('cert_card_added')}</span>
                        </div>`;
        } else {
            card.classList.add('cursor-pointer');
            footerHtml = `<button class="g-btn g-btn-outlined mt-4">Voir la certification</button>`;
        }

        card.innerHTML = `
            <div class="flex-1">
                <div class="flex items-start gap-4">
                    <div class="text-4xl">${c.emoji}</div>
                    <div>
                        <h4 class="font-medium text-slate-800">${c.title[state.language]}</h4>
                        <p class="mt-2 text-sm text-slate-500">${c.rationale[state.language]}</p>
                    </div>
                </div>
            </div>
            <div class="mt-4">${footerHtml}</div>
        `;
        
        if (!isAdded) {
            card.addEventListener('click', () => openCertModal(c.id));
        }

        grid.appendChild(card);
      });
    }

    function renderConsole() {
        const c = $("#console");
        if (!state.logs || state.logs.length === 0) {
            c.innerHTML = `<span class="text-slate-400">En attente de connexion...</span>`;
            return;
        }
        c.innerHTML = state.logs.map(l => {
            const msg = T(l.key, l.replacements);
            return `<div class="flex items-start gap-3 fade-in">
                      <span class="material-symbols-outlined text-lg text-slate-500 mt-0.5">${l.icon}</span>
                      <div>${msg}</div>
                    </div>`;
        }).join("");
        c.scrollTop = c.scrollHeight;
    }

    function renderAll() {
      if (!state.provider) {
        renderLLMButtons();
      }
      renderRadar();
      renderRecos();
      renderSkillProgress();
      renderCerts();
      renderConsole();
      
      if (state.provider) {
        let logoHtml;
        if (state.provider === 'Ollama') {
            logoHtml = `<img src="https://ollama.com/public/ollama.png" class="h-4 w-4 object-contain">`;
        } else {
            const logoUrl = {
              ChatGPT: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/light/openai.png",
              Gemini: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1280px-Google_Gemini_logo.svg.png",
              Claude: "https://cdn.worldvectorlogo.com/logos/anthropic-1.svg",
              Mistral: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/mistral-color.png",
              Llama: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Meta_Platforms_Inc._logo_%28cropped%29.svg/2560px-Meta_Platforms_Inc._logo_%28cropped%29.svg.png"
            }[state.provider];
            logoHtml = `<img src="${logoUrl}" class="h-5 object-contain">`;
        }
        $('#providerBadge').innerHTML = `${logoHtml} <span class="ml-2">${state.provider}</span>`;
        $('#aiInsightText').textContent = PROVIDERS[state.provider].insight[state.language];
        $('#objectiveText').textContent = (CONTEXTS.find(c => c.id === state.context) || {}).label?.[state.language] || '-';
        $('#user-badge').classList.remove('hidden');
        $('#user-badge').classList.add('flex');
      } else {
        $('#user-badge').classList.add('hidden');
      }
    }

    // --- CORE LOGIC ---------------------------------------------------------
    async function connectTo(name) {
      state.provider = name;
      state.logs = [];
      state.recos = [];
      state.skills = JSON.parse(JSON.stringify(initialSkills));
      if (name === 'Ollama' && !state.skills.find(s => s.competency.fr === "Gestion de projet")) {
        state.skills.push({ competency: { fr: "Gestion de projet", en: "Project Management" }, level: 40 });
      }
      state.initialSkillsSnapshot = JSON.parse(JSON.stringify(state.skills));

      $('#pre-connection-view').classList.add('hidden');
      $('#post-connection-view').classList.remove('hidden');
      
      const log = (key, icon, replacements) => { state.logs.push({key, icon, replacements}); renderConsole(); };

      log('log_connecting', 'hub', {provider: name});
      await new Promise(r => setTimeout(r, 500));
      
      const conf = PROVIDERS[name];
      log('log_analysis', 'query_stats');
      await new Promise(r => setTimeout(r, 800));
      
      conf.deltas.forEach(d => {
          const skillToUpdate = state.skills.find(s => s.competency.fr === d.skill);
          if(skillToUpdate) skillToUpdate.level = Math.min(100, skillToUpdate.level + d.delta);
          log('log_skill_gain', 'trending_up', {skill: d.skill, delta: d.delta, why: d.why});
      });
      await new Promise(r => setTimeout(r, 500));
      
      log('log_recos_generated', 'rocket_launch');
      state.recos = conf.recos.map((r,i)=> ({ id: `${name}-${i}`, status: 'idle', ...r }));

      renderAll();
      showNotification(`${T('connected_to')} ${name} !`, 'success');
    }

    function applyReco(recoId) {
        const reco = state.recos.find(r => r.id === recoId);
        if (!reco || reco.status !== 'idle') return;

        reco.status = 'pending';
        renderAll();

        setTimeout(() => {
            completeReco(recoId);
        }, 1500);
    }

    function completeReco(recoId) {
        const reco = state.recos.find(r => r.id === recoId);
        if (!reco || reco.status !== 'pending') return;

        const skillToUpdate = state.skills.find(s => s.competency.fr === reco.skill);
        if (skillToUpdate) {
            skillToUpdate.level = Math.min(100, skillToUpdate.level + reco.delta);
        }
        reco.status = 'completed';
        const skillName = skillToUpdate.competency[state.language];
        const log = (key, icon, replacements) => { state.logs.push({key, icon, replacements}); renderConsole(); };
        log('log_challenge_complete', 'check_circle', { title: reco.title[state.language], delta: reco.delta });
        showNotification(`${skillName} +${reco.delta} pts!`, 'info');
        renderAll();
    }

    function reset() {
      state.provider = null;
      state.skills = [];
      state.recos = [];
      state.logs = [];
      state.certificationStatus = {};
      $('#pre-connection-view').classList.remove('hidden');
      $('#post-connection-view').classList.add('hidden');
      updateUI();
    }

    // --- MODAL LOGIC --------------------------------------------------------
    function setupModals() {
      $('#showJsonBtn').addEventListener('click', () => {
        $('#jsonContent').textContent = JSON.stringify(olmExampleJson, null, 2);
        $('#jsonModal').classList.remove('hidden');
        $('#jsonModal').classList.add('flex');
      });
      $('#jsonModal').querySelectorAll('[data-json-close]').forEach(btn => {
        btn.addEventListener('click', () => {
          $('#jsonModal').classList.add('hidden');
          $('#jsonModal').classList.remove('flex');
        });
      });
      
      $('#certModal').querySelectorAll('[data-cert-close]').forEach(btn => {
        btn.addEventListener('click', () => closeCertModal());
      });

      $('#consentModal').querySelectorAll('[data-consent-close]').forEach(btn => {
        btn.addEventListener('click', () => closeConsentModal());
      });
    }

    function openConsentModal(name) {
        state.pendingProvider = name;
        const m = $('#consentModal');
        const title = $('#consentModalTitle');
        
        let logoHtml;
        if (name === 'Ollama') {
            logoHtml = `<img src="https://ollama.com/public/ollama.png" class="h-6 w-6 object-contain inline-block">`;
        } else {
            const logoUrl = {
              ChatGPT: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/light/openai.png",
              Gemini: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1280px-Google_Gemini_logo.svg.png",
              Claude: "https://cdn.worldvectorlogo.com/logos/anthropic-1.svg",
              Mistral: "https://registry.npmmirror.com/@lobehub/icons-static-png/latest/files/dark/mistral-color.png",
              Llama: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Meta_Platforms_Inc._logo_%28cropped%29.svg/2560px-Meta_Platforms_Inc._logo_%28cropped%29.svg.png"
            }[name];
            logoHtml = `<img src="${logoUrl}" class="h-6 object-contain inline-block">`;
        }
        title.innerHTML = `${T('modal_title')} ${logoHtml} <strong>${name}</strong>`;

        const consentsHost = $('#consents');
        consentsHost.innerHTML = '';
        const consentOptions = [
            {key: 'competences', label: 'Comp√©tences'},
            {key: 'historique', label: 'Historique de recherches'},
            {key: 'objectifs', label: 'Objectifs professionnels'},
            {key: 'notes', label: 'Notes'},
            {key: 'disponibilites', label: 'Disponibilit√©s'}
        ];
        consentOptions.forEach(opt => {
            const id = `consent_${opt.key}`;
            const row = el("div","flex items-center gap-3");
            row.innerHTML = `<div class="flex items-center"><input type="checkbox" id="${id}" ${state.consents[opt.key] ? 'checked' : ''} class="h-4 w-4 rounded border-slate-400 bg-slate-200 text-pink-600 focus:ring-pink-500 focus:ring-offset-slate-100"><label for="${id}" class="ml-3 block text-sm text-slate-700">${opt.label}</label></div>`;
            row.querySelector('input').addEventListener('change', e => state.consents[opt.key] = e.target.checked);
            consentsHost.appendChild(row);
        });

        const contextSelect = $('#contextSelect');
        const renderContextOptions = () => {
            contextSelect.innerHTML = '';
            CONTEXTS.forEach(c => {
                const o = el('option');
                o.value = c.id;
                o.textContent = c.label[state.language];
                contextSelect.appendChild(o);
            });
            contextSelect.value = state.context;
        }
        renderContextOptions();
        contextSelect.onchange = e => state.context = e.target.value;

        $('#addContextBtn').onclick = () => {
            const newContextLabel = prompt(T('add_context_prompt'));
            if (newContextLabel && newContextLabel.trim() !== "") {
                const newContextId = `custom_${Date.now()}`;
                CONTEXTS.push({ id: newContextId, label: {fr: newContextLabel.trim(), en: newContextLabel.trim()} });
                state.context = newContextId;
                renderContextOptions();
            }
        };

        $('#authorizeBtn').onclick = () => {
            closeConsentModal();
            connectTo(state.pendingProvider);
        };

        m.classList.remove('hidden');
        m.classList.add('flex');
    }

    function closeConsentModal() {
        $('#consentModal').classList.add('hidden');
        $('#consentModal').classList.remove('flex');
    }

    function openCertModal(certId) {
        const cert = CERTIFICATIONS.find(c => c.id === certId);
        if (!cert) return;
        
        const m = $("#certModal");
        $('#certModalTitle').textContent = T('cert_modal_title', { title: cert.title[state.language] });
        $('#certModalSubtitle').textContent = T('cert_modal_subtitle', { agent: state.provider });
        $('#certModalRationale').textContent = cert.rationale[state.language];

        const syllabusContainer = $('#certSyllabusContainer');
        const syllabusList = $('#certSyllabusList');
        const viewSyllabusBtn = $('#viewSyllabusBtn');
        const addCertBtn = $('#addCertToAgentBtn');
        
        syllabusContainer.classList.add('hidden');
        syllabusList.innerHTML = cert.syllabus[state.language].map(item => `<li>${item}</li>`).join('');
        viewSyllabusBtn.textContent = T('cert_modal_syllabus_btn');
        addCertBtn.textContent = T('cert_modal_add_btn');

        viewSyllabusBtn.onclick = () => {
            const isHidden = syllabusContainer.classList.toggle('hidden');
            viewSyllabusBtn.textContent = isHidden ? T('cert_modal_syllabus_btn') : T('cert_modal_syllabus_btn_hide');
        };

        addCertBtn.onclick = () => {
            state.certificationStatus[certId] = 'added';
            showNotification(T('cert_added_notice'), 'success');
            closeCertModal();
            renderCerts();
        };

        m.classList.remove('hidden');
        m.classList.add('flex');
    }

    function closeCertModal() {
        $('#certModal').classList.add('hidden');
        $('#certModal').classList.remove('flex');
    }

    // --- INITIALIZATION -----------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        $('#home-link').addEventListener('click', (e) => {
            e.preventDefault();
            reset();
        });
        $('#lang-fr').addEventListener('click', () => { state.language = 'fr'; updateUI(); });
        $('#lang-en').addEventListener('click', () => { state.language = 'en'; updateUI(); });
        
        setupModals();
        updateUI();
        
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(renderRadar, 150);
        });
    });
  </script>
</body>
</html>